> 本文内容由[Help:计算](https://zh.wikipedia.org/wiki/Help:计算)转换而来。


借助于Mediawiki的扩展“函数解析器”，进行计算变得可行。

  - 注意：目前此功能还有bug，详情见[meta:Talk:ParserFunctions\#Bugs](https://zh.wikipedia.org/wiki/meta:Talk:ParserFunctions#Bugs "wikilink")。

`expr`函数，计算数学表达式。语法为：

    {{#expr: ''表达式'' }}

表达式支持的运算符有：

| 运算符   | 名称   | 优先级 | 元数 | 结合性 | 样例                                                      |
| ----- | ---- | --- | -- | --- | ------------------------------------------------------- |
| \+    | 正    | 9   | 1  | 右   | {{\#expr: + 7}} = {{\#expr: + 7}}                       |
| \-    | 负    | 9   | 1  | 右   | {{\#expr: - 7}} = {{\#expr: - 7}}                       |
| not   | 逻辑非  | 9   | 1  | 右   | {{\#expr: not 7}} = {{\#expr: not 7}}                   |
| \*    | 乘    | 8   | 2  | 左   | {{\#expr: 30 \* 7}} = {{\#expr: 30 \* 7}}               |
| /     | 除    | 8   | 2  | 左   | {{\#expr: 30 / 7}} = {{\#expr: 30 / 7}}                 |
| div   | 除    | 8   | 2  | 左   | {{\#expr: 30 div 7}} = {{\#expr: 30 div 7}}             |
| mod   | 模    | 8   | 2  | 左   | {{\#expr: 30 mod 7}} = {{\#expr: 30 mod 7}}             |
| \+    | 加    | 6   | 2  | 左   | {{\#expr: 30 + 7}} = {{\#expr: 30 + 7}}                 |
| \-    | 减    | 6   | 2  | 左   | {{\#expr: 30 - 7}} = {{\#expr: 30 - 7}}                 |
| round | 舍入   | 5   | 2  | 左   | {{\#expr: 30 / 7 round 7}} = {{\#expr: 30 / 7 round 7}} |
| \=    | 等于   | 4   | 2  | 左   | {{\#expr: 30 = 7}} = {{\#expr: 30 = 7}}                 |
| \<    | 小于   | 4   | 2  | 左   | {{\#expr: 30 \< 7}} = {{\#expr: 30 \< 7}}               |
| \>    | 大于   | 4   | 2  | 左   | {{\#expr: 30 \> 7}} = {{\#expr: 30 \> 7}}               |
| \<=   | 小于等于 | 4   | 2  | 左   | {{\#expr: 30 \<= 7}} = {{\#expr: 30 \<= 7}}             |
| \>=   | 大于等于 | 4   | 2  | 左   | {{\#expr: 30 \>= 7}} = {{\#expr: 30 \>= 7}}             |
| \<\>  | 不等于  | 4   | 2  | 左   | {{\#expr: 30 \<\> 7}} = {{\#expr: 30 \<\> 7}}           |
| \!=   | 不等于  | 4   | 2  | 左   | {{\#expr: 30 \!= 7}} = {{\#expr: 30 \!= 7}}             |
| and   | 逻辑与  | 3   | 2  | 左   | {{\#expr: 30 and 7}} = {{\#expr: 30 and 7}}             |
| or    | 逻辑或  | 2   | 2  | 左   | {{\#expr: 30 or 7}} = {{\#expr: 30 or 7}}               |

round运算对运算数正负，位数正负都有不同的表现，参见下例。

逻辑运算符把假映射为0，把真映射为非0，且返回值只有0或1。

同一表达式中先计算高优先级运算。括号优先级高于一切。

## 样例

  - `{{#expr: (100 - 32) / 9 * 5 round 0 }}` = {{\#expr: (100 - 32) / 9 \* 5 round 0 }}：[摄氏](https://zh.wikipedia.org/wiki/攝氏溫標 "wikilink")[华氏](https://zh.wikipedia.org/wiki/華氏溫標 "wikilink")[温度](../Page/温度.md "wikilink")[度](https://zh.wikipedia.org/wiki/度 "wikilink")[转换](../Page/温度单位换算.md "wikilink")
  - `{{#expr: 3 < 2 < 1}}` = {{\#expr: 3 \< 2 \< 1}}
  - `{{#expr: 2 = 2 = 1}}` = {{\#expr: 2 = 2 = 1}}：与数学表达式不同，“=”、“\<”、“\>”等运算符有返回值
  - `{{#expr: 999 * 999 round -2}}` = {{\#expr: 999 \* 999 round -2}}
  - `{{#expr: 999 * 999 round -20}}` = {{\#expr: 999 \* 999 round -20}}
  - `{{#expr: 999 * 999 round -2.9}}` = {{\#expr: 999 \* 999 round -2.9}}：round的危险用法
  - `{{#expr: 1 or 1 and 0}}` = {{\#expr: 1 or 1 and 0}}：优先级演示
  - `{{#expr: 10.9 mod 2}}` = {{\#expr: 10.9 mod 2}}：[mod的危险用法](../Page/同餘.md "wikilink")
  - `{{#expr: 30------7}}` = {{\#expr: 30-----7}}
  - `{{#expr: 30+++++7}}` = {{\#expr: 30+++++7}}：“+”、“-”运算符有两种含义
  - `{{#expr: .}}` = {{\#expr: .}}
  - `{{#expr: .1.1}}` = {{\#expr: .1.1}}：[实数](../Page/实数.md "wikilink")表达法的多样性（多出的小数点会被无视）
  - `{{#expr: ( ( ) )}}` = {{\#expr: ( ( ) )}}：特殊的[括号](../Page/括号.md "wikilink")用法，没有实际意义
  - `{{#expr: 999999999*...*999999999}}` = {{\#expr: 999999999\*999999999\*999999999\*999999999\*999999999\*999999999\*999999999\*999999999\*999999999\*999999999\*999999999\*999999999\*999999999\*999999999\*999999999\*999999999\*999999999\*999999999\*999999999\*999999999\*999999999\*999999999\*999999999\*999999999\*999999999\*999999999\*999999999\*999999999\*999999999\*999999999\*999999999\*999999999\*999999999\*999999999\*999999999\*999999999\*999999999\*999999999\*999999999\*999999999\*999999999\*999999999\*999999999\*999999999\*999999999\*999999999\*999999999\*999999999\*999999999\*999999999\*999999999\*999999999\*999999999\*999999999\*999999999\*999999999\*999999999\*999999999\*999999999\*999999999\*999999999\*999999999\*999999999\*999999999\*999999999\*999999999\*999999999\*999999999\*999999999\*999999999\*999999999\*999999999\*999999999\*999999999\*999999999\*999999999\*999999999\*999999999\*999999999\*999999999\*999999999\*999999999\*999999999\*999999999\*999999999\*999999999\*999999999\*999999999\*999999999\*999999999\*999999999\*999999999\*999999999\*999999999\*999999999\*999999999\*999999999\*999999999\*999999999\*999999999\*999999999\*999999999\*999999999\*999999999\*999999999\*999999999\*999999999\*999999999\*999999999\*999999999\*999999999\*999999999}}：[数字上溢的结果](https://zh.wikipedia.org/wiki/算術溢位 "wikilink")
  - `{{#expr:(-1)^0.5}}` = {{\#expr:(-1)^0.5}}：無法對[虛數單位](../Page/虛數單位.md "wikilink")進行計算
  - `{{Root|(-1)}}` = ：使用根號模板

## 错误

此函数进行错误检查并给出信息。

  - Expression error: stack exhausted：表达式太长，栈耗尽；
  - Expression error: unexpected number：不可预期的数字；
  - Expression error: unexpected preg_match failure：运算符匹配失败；
  - Expression error: unrecognised word "$1"：不可识别的运算符；
  - Expression error: unexpected $1 operator：不可预期的运算符；
  - Expression error: Missing operand for $1：缺少运算数；
  - Expression error: unexpected closing bracket：不可预料的“)”
  - Expression error: unrecognised punctuation character "$1"：不可识别的标点字符；
  - Expression error: unclosed bracket：缺少“)”
  - Division by zero：零除错误。

### 错误的样例

  - `{{#expr: ---...---1}}（110个“-”）` = {{\#expr: --------------------------------------------------------------------------------------------------------------1}}
  - `{{#expr: ( ) 1}}` = {{\#expr: ( ) 1}}
  - `{{#expr: 2 d 1}}` = {{\#expr: 2 d 1}}
  - `{{#expr: * 1}}` = {{\#expr: \* 1}}
  - `{{#expr: -}}` = {{\#expr: -}}
  - `{{#expr: ( 1 ) )}}` = {{\#expr: ( 1 ) )}}
  - `{{#expr: 壹}}` = {{\#expr: 壹}}
  - `{{#expr: ( 1}}` = {{\#expr: ( 1}}
  - `{{#expr: 1 / 0}}` = {{\#expr: 1 / 0}}

## 误差

[浮点](https://zh.wikipedia.org/wiki/浮点 "wikilink")[误差](../Page/误差.md "wikilink")有可能造成某些运算的不可预料的结果，特别是最后几位数字的不精确。因此在使用此函数进行[实数](../Page/实数.md "wikilink")运算时，注意不要进行比较运算。

## 注意内部数字表示

  - `{{#expr: 100000000000000000}}` = {{\#expr: 100000000000000000}}
  - `{{#expr: {{#expr: 100000000000000000}}}}` = {{\#expr: {{\#expr: 100000000000000000}}}}
  - `{{#expr: (-1.5-0.5 round 0)+2}}` = {{\#expr: (-1.5-0.5 round 0)+2}}
  - `{{#expr: -0.1 round 0}}` = {{\#expr: -0.1 round 0}}
  - `{{#expr: 2017.5000 round 3}}` = {{\#expr: 2017.5000 round 3}}：使用時會有無法補零的情形。欲補零，可以使用模板來解決

在返回值中，有可能出现无法**再计算**的数的情况，或者有一部分[有效数字](../Page/有效数字.md "wikilink")没有显示出来。因此在使用此函数进行运算时，须注意这些问题。

## 参见

  - [Help:模板扩展语法](https://zh.wikipedia.org/wiki/Help:模板扩展语法 "wikilink")
  - 更多资料可参见[:m:help:Calculation](https://zh.wikipedia.org/wiki/:m:help:Calculation "wikilink")。

{{-}}

[Category:維基百科文字幫助文檔](https://zh.wikipedia.org/wiki/Category:維基百科文字幫助文檔 "wikilink")
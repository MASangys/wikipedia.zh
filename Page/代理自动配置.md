**代理自动配置**（，简称PAC）是一种网页浏览器技术，用于定义浏览器该如何自动选择适当的代理服务器来访问一个网址。

一个PAC文件包含一个[JavaScript](../Page/JavaScript.md "wikilink")形式的函数“FindProxyForURL(url, host)”。这个函数返回一个包含一个或多个访问规则的字符串。用户代理根据这些规则适用一个特定的代理器或者直接访问。当一个代理服务器无法响应的时候，多个访问规则提供了其他的后备访问方法。浏览器在访问其他页面以前，首先访问这个PAC文件。PAC文件中的URL可能是手工配置的，也可能是是通过网页的[网络代理自动发现协议](../Page/网络代理自动发现协议.md "wikilink")（WPAD）自动配置的。

## 相关技术

现代的浏览器实现了几个级别的自动化；用户可以选择最适合他们需要的级别。下面的这些方法被普遍的实现：

  - 手动代理配置：为所有的URLs规定一个主机名和端口作为代理。大多数浏览器允许用户规定一个域名的列表（例如localhost），访问这个列表里面的域名的时候不通过代理服务器。
  - 代理自动配置（PAC）：规定一个指向PAC文件的URL，这个文件中包括一个[JavaScript](../Page/JavaScript.md "wikilink")函数来确定访问每个URL时所选用的合适代理。这个方法更加适合需要几个不同代理配置的[筆記型電腦](../Page/筆記型電腦.md "wikilink")用户，或者有很多不同代理服务器的复杂的企业级设置。这个就是我们在本文中所要讨论的。
  - 网络代理自发现协议（WPAD）：浏览器通过DHCP和DNS的查询来搜索PAC文件的位置。

## PAC文件

要使用PAC，应当在一个网页服务器上发布一个PAC文件，并且通过在浏览器的代理链接设置页面输入这个PAC文件的URL或者通过使用[WPAD协议告知用户代理去使用这个文件](https://zh.wikipedia.org/wiki/WPAD "wikilink")。

一个PAC文件是一个至少定义了一个[JavaScript](../Page/JavaScript.md "wikilink")函数的文本文件。这个函数FindProxyForURL(url, host)有2个参数：url是一个对象的URL，host是一个由这个URL所衍生的主机名。按照惯例，这个文件名字一般是proxy.pac. [WPAD标准使用wpad](https://zh.wikipedia.org/wiki/WPAD "wikilink").dat。

虽然大多数客户端无论从[HTTP请求返回的](https://zh.wikipedia.org/wiki/HTTP "wikilink")[MIME类型是什么都能正确处理](https://zh.wikipedia.org/wiki/MIME "wikilink")，但为了完整性和最佳的兼容性，我们应该设置[网页服务器将这个文件的](https://zh.wikipedia.org/wiki/网页服务器 "wikilink")[MIME类型声明为application](https://zh.wikipedia.org/wiki/MIME "wikilink")/x-ns-proxy-autoconfig或者application/x-javascript-config。

没有什么理由偏爱一种[MIME类型多一些](https://zh.wikipedia.org/wiki/MIME "wikilink")，如果有的话，假设application/x-ns-proxy-autoconfig相对application/x-javascript-config被更多的客户端所支持是可以理解的。因为它被定义在最初的[Netscape规范里面](https://zh.wikipedia.org/wiki/Netscape "wikilink")，后者是最近才开始被使用。

一个非常简单的PAC文件内容

``` javascript
   function FindProxyForURL(url, host) { return "PROXY proxy.example.com:8080; DIRECT"; }
```

这个函数告知浏览器通过服务器proxy.example.com的8080端口来获取所有的页面。如果这个服务器没有反应，那么浏览器应该不使用[代理服务器](../Page/代理服务器.md "wikilink")直接访问[WWW](https://zh.wikipedia.org/wiki/WWW "wikilink"). 下面是一个更加复杂一些的例子，展示了在FindProxyForURL函数中如何使用[JavaScript](../Page/JavaScript.md "wikilink")函数：

``` javascript
   function FindProxyForURL(url, host) {
      // our local URLs from the domains below example.com don't need a proxy:
      if (shExpMatch(url,"*.example.com/*"))                  {return "DIRECT";}
      if (shExpMatch(url, "*.example.com:*/*"))               {return "DIRECT";}

      // URLs within this network are accessed through
      // port 8080 on fastproxy.example.com:
      if (isInNet(host, "10.0.0.0",  "255.255.248.0"))    {
         return "PROXY fastproxy.example.com:8080";
      }

      // All other requests go through port 8080 of proxy.example.com.
      // should that fail to respond, go directly to the WWW:
      return "PROXY proxy.example.com:8080; DIRECT";
   }
```

### 局限

#### PAC文件编码

有些浏览器，例如Internet Explorer只支持系统缺省编码的PAC文件，不支持[Unicode编码的PAC文件](https://zh.wikipedia.org/wiki/Unicode "wikilink")，例如[UTF-8](../Page/UTF-8.md "wikilink")编码的PAC文件。

#### DnsResolve

函数dnsResolv（及其他类似函数）在执行[DNS查询时](https://zh.wikipedia.org/wiki/DNS "wikilink")，如果[DNS服务器没有回应](https://zh.wikipedia.org/wiki/DNS "wikilink")，这个会导致你的浏览器被阻塞很长时间。 [Microsoft的IE](https://zh.wikipedia.org/wiki/Microsoft "wikilink")5.5或更高版本浏览器提供的基于域名的代理自动配置缓存机制限制了PAC标准的灵活性。实际上，你是通过域名来选择[代理服务器](../Page/代理服务器.md "wikilink")，而不是通过URL路径。当然，你可以通过修改[注册表](../Page/注册表.md "wikilink")的方法来关闭代理自动配置的缓存，Royne Pollard描述了这个步骤（详见[深入阅读](https://zh.wikipedia.org/wiki/#深入阅读 "wikilink")）。

为了兼容[Windows中其他使用Internet](https://zh.wikipedia.org/wiki/Windows "wikilink") Explorer PAC设置的组件，例如[.NET](https://zh.wikipedia.org/wiki/.NET "wikilink") 2.0框架，推荐在isInNet函数中使用[IP而不是主机名](https://zh.wikipedia.org/wiki/IP "wikilink")。

``` javascript
if (isInNet(host, dnsResolve(sampledomain) , "255.255.248.0") // .NET 2.0 will resolve proxy properly

if (isInNet(host, sampledomain, "255.255.248.0") // .NET 2.0 will not resolve proxy properly
```

当一个PAC文件不可用的时候，当前的缺省方法是使用直接链接。

其他的限制与本地机器上[JavaScript](../Page/JavaScript.md "wikilink")引擎有关。

### 高级功能

有些高级的PAC文件可以在请求到达[代理服务器](../Page/代理服务器.md "wikilink")以前通过负载平衡、故障转移甚至黑白名单得方法减少对于[代理服务器](../Page/代理服务器.md "wikilink")的负载。并且可以返回多个代理服务器，例如：

``` javascript
      return "PROXY proxy1.example.com:8080; PROXY proxy2.example.com:8080";
```

## 用途

### 用于[突破网络审查](../Page/突破网络审查.md "wikilink")

pac支持所有主流浏览器，如[Chrome](https://zh.wikipedia.org/wiki/Chrome "wikilink")、[Firefox](../Page/Firefox.md "wikilink")、[IE](https://zh.wikipedia.org/wiki/IE "wikilink")。可以在浏览器的网络配置里找到相关选项。

一些可用的pac自动代理配置的地址：

  - <https://pac.itzmx.com/abc.pac>\[1\]

## 参考资料

## 外部链接

  - [Navigator Proxy Auto-Config File Format](https://web.archive.org/web/20060424005037/http://wp.netscape.com/eng/mozilla/2.0/relnotes/demo/proxy-live.html) <small>（from the Release Notes for [Netscape Navigator 2.0](https://zh.wikipedia.org/wiki/Netscape_Navigator "wikilink")）</small>
  - [Using the Client Autoconfiguration File](https://web.archive.org/web/20040810122331/http://developer.netscape.com/docs/manuals/proxy/adminux/autoconf.htm) <small>（Chapter 11 of *Netscape Proxy Server Administrator's Guide*, version 3.5 for Unix）</small>
  - [Description of proxy auto-configuration files from Microsoft](https://web.archive.org/web/20081221125633/http://www.microsoft.com/technet/prodtechnol/ie/reskit/6/part6/c26ie6rk.mspx?mfr=true)
  - [ReturnProxy.com - The Practical Proxy PAC File Guide and Forums](http://www.returnproxy.com)
  - [PAC File & WPAD Examples](http://www.findproxyforurl.com)
  - [pacparser](http://code.google.com/p/pacparser) C and Python library to parse PAC files.
  - [Pactester](http://code.google.com/p/pactester) A tool to test PAC files.
  - [A web front-end for the Google PAC Tester](http://www.returnproxy.com/proxypac/index.php?option=com_wrapper&view=wrapper&Itemid=101)
  - [proxyvalidator](https://web.archive.org/web/20090828110324/http://luno.org/project/proxyvalidator) Test all destination proxies within a PAC file.
  - [PAC-file to filter bad hosts and pornography](http://www.securemecca.com/pac.html)
  - [Proxy Auto Config "how to". Fully working examples including anti-ad and anti-adult filter rules.](https://calomel.org/proxy_auto_config.html)

[Category:網頁瀏覽器](https://zh.wikipedia.org/wiki/Category:網頁瀏覽器 "wikilink") [Category:代理伺服器](https://zh.wikipedia.org/wiki/Category:代理伺服器 "wikilink")

1.  <http://pac.itzmx.com/>
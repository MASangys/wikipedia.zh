[Callback-notitle.svg](https://zh.wikipedia.org/wiki/File:Callback-notitle.svg "fig:Callback-notitle.svg") 在[计算机程序设计中](https://zh.wikipedia.org/wiki/计算机程序设计 "wikilink")，**回调函数**，或简称**回调**（Callback 即call then back 被主函数调用运算后会返回主函数），是指通过传递到其它代码的，某一块[可执行代码的](https://zh.wikipedia.org/wiki/可执行文件 "wikilink")[引用](../Page/引用.md "wikilink")。这一设计允许了[底层代码调用在高层定义的](https://zh.wikipedia.org/wiki/抽象层 "wikilink")[子程序](../Page/子程序.md "wikilink")。

## 使用

回调的用途十分广泛。例如，假设有一个函数，其功能为读取配置文件并由文件内容设置对应的选项。若这些选项由[散列值所标记](https://zh.wikipedia.org/wiki/散列函数 "wikilink")，则让这个函数接受一个回调会使得程序设计更加灵活：函数的调用者可以使用所希望的散列算法，该算法由一个将选项名转变为散列值的回调函数实现；因此，回调允许函数调用者在运行时调整原始函数的行为。

回调的另一种用途在于处理信号或者类似物。例如一个[POSIX程序可能在收到](https://zh.wikipedia.org/wiki/POSIX "wikilink")[SIGTERM信号时不愿立即终止](https://zh.wikipedia.org/wiki/SIGTERM "wikilink")；为了保证一切运行良好，该程序可以将清理函数注册为SIGTERM信号对应的回调。

回调亦可以用于控制一个函数是否作为：[Xlib](../Page/Xlib.md "wikilink")允许自定义的[谓词用于决定程序是否希望处理特定的事件](https://zh.wikipedia.org/wiki/谓词 "wikilink")。

## 例子

下列[C语言代码描述了利用回调处理](https://zh.wikipedia.org/wiki/C语言 "wikilink")[POSIX风格的信号](https://zh.wikipedia.org/wiki/POSIX "wikilink")（在本示例中为[SIGUSR1](https://zh.wikipedia.org/wiki/SIGUSR1和SIGUSR2 "wikilink")）的过程。值得注意的是，在处理信号的过程中，调用[`printf(3)`](https://zh.wikipedia.org/wiki/printf "wikilink")是[不安全的](https://zh.wikipedia.org/wiki/信号_\(计算机科学\)#风险 "wikilink")。

``` c
#include <stdio.h>
#include <signal.h>
#include <unistd.h>

void sig(int signum)
{
        printf("Received signal number %d!\n", signum);
}

int main(int argc, char *argv[])
{
        signal(SIGUSR1, sig);

        pause();

        return 0;
}
```

系统调用`pause(3)`会导致这个例子不做任何有意义的事，但这样做可以给你充分的时间来给这个进程发送信号。（在类Unix系统上，可以调用` kill -USR1  `**<pid>**，其中**<pid>**代表该程序的进程号。运行之后，该程序应当会有反应。）

## 实现

回调的形式因[程序设计语言而有差别](https://zh.wikipedia.org/wiki/程序设计语言 "wikilink")。

  - [C](https://zh.wikipedia.org/wiki/C语言 "wikilink")、[C++](../Page/C++.md "wikilink")和[Pascal允许将](../Page/Pascal_\(程式語言\).md "wikilink")[函数指针](../Page/函数指针.md "wikilink")作为参数传递给其它函数。其它语言，例如[JavaScript](../Page/JavaScript.md "wikilink")，[Python](../Page/Python.md "wikilink")，[Perl](../Page/Perl.md "wikilink")\[1\]\[2\]和[PHP](../Page/PHP.md "wikilink")，允许简单的将函数名作为参数传递。

<!-- end list -->

  - [Objective-C](../Page/Objective-C.md "wikilink")中允许利用@selector关键字传递SEL类型的函数名。在实现中，SEL类型被定义为函数名字符串。

<!-- end list -->

  - 在类似于[C\#与](https://zh.wikipedia.org/wiki/C_Sharp "wikilink")[VB.NET的运用](https://zh.wikipedia.org/wiki/VB.NET "wikilink")[.NET Framework的语言中](https://zh.wikipedia.org/wiki/.NET_Framework "wikilink")，提供了一种[型别安全的引用封装](https://zh.wikipedia.org/wiki/型别安全 "wikilink")，所谓的'[委托](https://zh.wikipedia.org/wiki/委托_\(.NET\) "wikilink")'，用来定义包含类型的[函数指针](../Page/函数指针.md "wikilink")，可以用于实现回调。

<!-- end list -->

  - .NET语言中用到的事件与事件处理函数提供了用于回调的通用语法。

<!-- end list -->

  - [函数式编程语言通常支持](https://zh.wikipedia.org/wiki/函数式编程语言 "wikilink")[第一级函数](https://zh.wikipedia.org/wiki/第一级函数 "wikilink")，可以作为回调传递给其它函数，也可以作为数据类型存储或是返回给其它函数。

<!-- end list -->

  - 某些语言，比如[Algol 68](../Page/ALGOL.md "wikilink")，[Perl](../Page/Perl.md "wikilink")，新版本的.NET语言以及多数[函数式编程语言中](https://zh.wikipedia.org/wiki/函数式编程语言 "wikilink")，允许使用[匿名的代码块](../Page/闭包_\(计算机科学\).md "wikilink")（[lambda表达式](https://zh.wikipedia.org/wiki/lambda表达式 "wikilink")），用以代替在别处定义的独立的回调函数。

<!-- end list -->

  - 在[Apple或是](https://zh.wikipedia.org/wiki/苹果公司 "wikilink")[LLVM](../Page/LLVM.md "wikilink")的C语言扩展中，包含称为[块的语言特性](../Page/块_\(C语言扩展\).md "wikilink")，可以作为函数的参数传递，作为回调的一种实现。

<!-- end list -->

  - 在缺少函数类型的参数的[面向对象的程序语言中](../Page/面向对象程序设计.md "wikilink")，例如[Java](../Page/Java.md "wikilink")，回调可以用传递抽象类或接口来模拟。回调的接收者会调用抽象类或接口的方法，这些方法由调用者提供实现。这样的对象通常是一些回调函数的集合，同时可能包含它所需要的数据。这种方法在实现某些[设计模式时比较有用](../Page/设计模式_\(计算机\).md "wikilink")，例如[访问者模式](../Page/访问者模式.md "wikilink")，[观察者模式](../Page/观察者模式.md "wikilink")与[策略模式](../Page/策略模式.md "wikilink")。

<!-- end list -->

  - C++允许对象提供其自己的函数调用操作的实现，即重载operator()。[标准模板库](../Page/标准模板库.md "wikilink")和函数指针一样接受这类对象（称为*[函数对象](../Page/函数对象.md "wikilink")*）作为各种算法的参数。

## 参见

  -
  -
  - [事件驱动程式设计](https://zh.wikipedia.org/wiki/事件驱动程式设计 "wikilink")

  - , C++的回调库

  - [控制反转](../Page/控制反转.md "wikilink")

## 外部链接

  - [Style Case Study \#2: Generic Callbacks](http://gotw.ca/gotw/083.htm)
  - [C++ Callback Solution](http://partow.net/programming/templatecallback/index.html)
  - [Basic Instincts: Implementing Callback Notifications Using Delegates](https://web.archive.org/web/20071009224137/http://msdn.microsoft.com/msdnmag/issues/02/12/BasicInstincts/)
  - [Implement Script Callback Framework in ASP.NET](https://web.archive.org/web/20041111063702/http://www.codeproject.com/aspnet/ScriptCallbackFramework.asp)
  - [Implement callback routines in Java](http://www.javaworld.com/javaworld/javatips/jw-javatip10.html)
  - [Interfacing C++ member functions with C libraries](https://web.archive.org/web/20110706132209/http://www.comp.ua.ac.be/publications/files/Adapter-Para04.pdf)

## 参考资料

[Category:带有C代码示例的条目](https://zh.wikipedia.org/wiki/Category:带有C代码示例的条目 "wikilink") [Category:计算机编程](https://zh.wikipedia.org/wiki/Category:计算机编程 "wikilink")

1.
2.
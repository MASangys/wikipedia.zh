**安全标识符** (Security
Identifier，**SID**)是[Windows操作系统使用的独一无二的](https://zh.wikipedia.org/wiki/Windows操作系统 "wikilink")，不变的标识符用于标识用户、用户群、或其他.

安全标识符一经产生，不会与全世界任何的安全标识符重复；也不随用户更名而变化。如果删除了用户帐户，然后再创建同名帐户，则产生的安全标识符是不同的。

## 用户SID格式

SID格式可用下例解释： "S-1-5-21-3623811015-3361044348-30300820-1013"

<table>
<thead>
<tr class="header">
<th><p>S</p></th>
<th><p>1</p></th>
<th><p>5</p></th>
<th><p>21-3623811015-3361044348-30300820</p></th>
<th><p>1013</p></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><p>The string is a SID.</p></td>
<td><p>The revision level (the version of the SID specification).</p></td>
<td><p>The identifier authority value.</p></td>
<td><p>Domain or local computer identifier</p></td>
<td><p>(RID). 任何用户或用户群不是默认创建，RID将大于等于1000.</p></td>
</tr>
</tbody>
</table>

### Identifier Authority Values

可能的值:

| Decimal | Name                        | Display Name       | First Introduced                                                 | References | Notes                                                                                                                                                       |
| ------- | --------------------------- | ------------------ | ---------------------------------------------------------------- | ---------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------- |
| 0       | Null Authority              |                    |                                                                  |            | e.g. "Nobody"                                                                                                                                               |
| 1       | World Authority             | (not shown)        |                                                                  |            | e.g. well known groups such as "Everyone".                                                                                                                  |
| 2       | Local Authority             | (not shown)        |                                                                  |            | e.g. flag SIDs like "CONSOLE LOGON"                                                                                                                         |
| 3       | Creator Authority           |                    |                                                                  |            |                                                                                                                                                             |
| 4       | Non-unique Authority        |                    |                                                                  |            |                                                                                                                                                             |
| 5       | NT Authority                | NT AUTHORITY\\     |                                                                  |            | Managed by the NT security subsystem. There are many sub-authorities such as "BUILTIN" and every [Active Directory](../Page/Active_Directory.md "wikilink") |
| 9       | Resource Manager Authority  |                    | [Windows Server 2003](../Page/Windows_Server_2003.md "wikilink") | \[1\]\[2\] |                                                                                                                                                             |
| 11      | Microsoft Account Authority | MicrosoftAccount\\ | [Windows 8](https://zh.wikipedia.org/wiki/Windows_8 "wikilink")  |            |                                                                                                                                                             |
| 16      |                             | Mandatory Label\\  | [Windows Vista](../Page/Windows_Vista.md "wikilink")             |            | Used as part of                                                                                                                                             |

## 机器SID格式

The machine SID is stored in the **SECURITY** registry hive located at
**SECURITY\\SAM\\Domains\\Account**, this key has two values **F** and
**V**. The **V** value is a binary value that has the computer SID
embedded within it at the end of its data (last 96 bits).\[3\]

  - "NewSID ensures that this SID is in a standard NT 4.0 format (3
    32-bit subauthorities preceded by three 32-bit authority fields).
    Next, NewSID generates a new random SID for the computer. NewSID's
    generation takes great pains to create a truly random 96-bit value,
    which replaces the 96-bits of the 3 subauthority values that make up
    a computer SID."
      - From NewSID readme.

The SID number is used in file, registry, service and users permissions.
The machine SID is determined in hexadecimal form from here:

  - `regedit.exe`: \\HKEY_LOCAL_MACHINE\\SAM\\SAM\\Domains\\Account\\V
    (last 12 bytes)
  - `explorer.exe`: \\%windir%\\system32\\config\\SAM

If the SAM file is missing at startup, a backup is retrieved in
hexadecimal form here:

  - `regedit.exe`: \\HKEY_LOCAL_MACHINE\\SECURITY\\Policy\\PolAcDmS\\@
    (last 12 bytes)
  - `explorer.exe`: \\%windir%\\system32\\config\\SECURITY

Sometimes the SID number is referenced in decimal form. \[4\]

<table>
<thead>
<tr class="header">
<th><p>Example</p></th>
<th></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><p>1) Divide the bytes into 3 sections:</p></td>
<td></td>
</tr>
<tr class="even">
<td><p>2) Reverse the order of bytes in each section:</p></td>
<td></td>
</tr>
<tr class="odd">
<td><p>3) Convert each section into decimal:</p></td>
<td></td>
</tr>
<tr class="even">
<td><p>4) Add the machine SID prefix:</p></td>
<td></td>
</tr>
</tbody>
</table>

## 系统服务的SID格式

Service SIDs are a feature of [service
isolation](https://zh.wikipedia.org/wiki/service_isolation "wikilink"),
a security feature introduced in [Windows
Vista](../Page/Windows_Vista.md "wikilink") and [Windows Server
2008](../Page/Windows_Server_2008.md "wikilink").\[5\] Any service with
the "unrestricted" SID-type property will have a service-specific SID
added to the access token of the service host process.

The purpose of Service SIDs is to allow permissions for a single service
to be managed without necessitating the creation of service accounts, an
administrative overhead.

Each service SID is a local, machine-level SID generated from the
service name using the following formula:

`S-1-5-80-{SHA-1(service name in upper case)}`

The sc.exe utility can be used to generate an arbitrary service SID:

<code> sc.exe showsid dnscache

NAME: dnscache SERVICE SID:
S-1-5-80-859482183-879914841-863379149-1145462774-2388618682 STATUS:
Active </code>

The service can also be referred to as NT SERVICE\\<service_name> (e.g.
"NT SERVICE\\dnscache").

## 参考文献

## 外部链接

  - Official
      - [ObjectSID and Active
        Directory](http://portal.sivarajan.com/2011/09/objectsid-and-active-directory.html)
      - [Microsoft TechNet: Server 2003: Security Identifiers Technical
        Reference](https://technet.microsoft.com/en-us/library/cc782090.aspx)
      - [MSKB154599: How to Associate a Username with a Security
        Identifier](http://support.microsoft.com/kb/154599)
      - [MSKB243330: Well-known security identifiers in Windows
        operating systems](http://support.microsoft.com/kb/243330)
      - [Support tools for Windows Server 2003 and Windows
        XP](http://www.microsoft.com/downloads/details.aspx?familyid=6EC50B78-8BE1-4E81-B3BE-4E7AC4F0912D&displaylang=en)
  - Other
      - [Why Understanding SIDs is
        Important](http://servermigrator.blogspot.com/2006/02/why-understanding-sids-is-important.html)
      - [Microsoft Security Descriptor (SID) Attributes : Tutorial
        Article about SID handling / converting in
        scripts](http://www.selfadsi.org/deep-inside/microsoft-sid-attributes.htm)

[Category:Microsoft_Windows](https://zh.wikipedia.org/wiki/Category:Microsoft_Windows "wikilink")

1.  See "Custom Principals" section on
    <https://msdn.microsoft.com/en-us/library/aa480244.aspx>
2.  <http://blogs.msdn.com/larryosterman/archive/2004/09/01/224051.aspx>
3.
4.  [Security Accounts Manager,
    *clark@hushmail.com*](http://www.beginningtoseethelight.org/ntsecurity/#3C091C8F1BF2345C)
5.
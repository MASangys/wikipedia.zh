**小波包分解**（wavelet packet decomposition）也可稱為**小波包**（wavelet
packet）或**子帶樹**（subband tree）及**最佳子帶樹結構**（optimal subband tree
structuring）。其概念是用分析樹來表示小波包，即利用多次疊代的小波轉換分析輸入訊號的細節部分。

## 與快速小波轉換比較

快速小波轉換（fast wavelet
transform）是將輸入訊號分解成對數刻度，如圖一所示，最左邊的圖是經過快速小波轉換，高頻的部分頻帶較寬，低頻較窄。若要更廣泛的控制時頻圖(例如把高頻的頻帶分得更細)，必須將快速小波轉換一般化，即稱為小波包分解。經過一般化後，複雜度從原本O(M)增加到O(MlogM)。
[WTTP1.jpg](https://zh.wikipedia.org/wiki/File:WTTP1.jpg "fig:WTTP1.jpg")

### 一維三階快速小波轉換

圖二是一維三階的快速小波轉換，最上方為流程圖，\(\mathit{V_J}\)為輸入訊號，\(\mathit{J} - P\)表示第\(\mathit{P}\)階，以此類推，\(\mathit{h_{\psi}}\)為縮放函數(scaling
function)的係數，\(\mathit{h_{\varphi}}\)為小波函數(wavelet
function)的係數；右下圖則是各個子空間(subspace)在頻譜上的分布，由此可知\(\mathit{V}\)表示低頻訊號，\(\mathit{W}\)表示高頻訊號，而左下圖是用二進位的樹枝圖來表示，因為佔的空間比流程圖來的少，用來分析有效的分解較為方便，此例而言\(\mathit{V_J}\)可分解成

\[\mathit{V_J} = \mathit{V_{J-1}} \oplus \mathit{W_{J-1}}\]

\[\mathit{V_J} = \mathit{V_{J-2}} \oplus \mathit{W_{J-2}} \oplus \mathit{W_{J-1}}\]

\[\mathit{V_J} = \mathit{V_{J-3}} \oplus \mathit{W_{J-3}} \oplus \mathit{W_{J-2}} \oplus \mathit{W_{J-1}}\]
\(\mathit{j0}\) = \(\mathit{J-P}\)，\(\mathit{P}\) = {1, 2,
3}，一般而言\(\mathit{P}\)-階快速小波轉換分析樹有\(\mathit{P}\)種不同的分解方式。
[WTTP3.png](https://zh.wikipedia.org/wiki/File:WTTP3.png "fig:WTTP3.png")

### 一維三階小波包分解

如前面所述，小波包分解利用多次疊代的小波轉換分析輸入訊號，因此經過三次的小波轉換後如圖三所示，其中\(\mathit{W}\)後面的\(\mathit{A}\)代表近似(approximation)過濾，可視為前一階訊號的低頻部分；\(\mathit{D}\)代表細節(detail)過濾，可視為前一階訊號的高頻部分。以子空間\(\mathit{W_{J-1,DA}}\)為例，\(\mathit{W_{J-1,DA}}\)是由第\(\mathit{J-1}\)階的快速小波轉換係數先經過一個細節濾波器(得到\(\mathit{W_{J-1,D}}\))後，再經過一個近似濾波器(得到\(\mathit{W_{J-1,DA}}\))。
[WTTP4.png](https://zh.wikipedia.org/wiki/File:WTTP4.png "fig:WTTP4.png")

圖四和圖五分別為一維三階小波包分解的流程圖及頻率特徵。

[WTTP5.png](https://zh.wikipedia.org/wiki/File:WTTP5.png "fig:WTTP5.png")
[WTTP6.png](https://zh.wikipedia.org/wiki/File:WTTP6.png "fig:WTTP6.png")

一維三階的小波包分解有26種不同的分解方式，可展開如圖五

\[\mathit{V_J} = \mathit{V_{J-3}} \oplus \mathit{W_{J-3}} \oplus \mathit{W_{J-2,A}} \oplus \mathit{W_{J-2,D}} \oplus \mathit{W_{J-1,AA}} \oplus \mathit{W_{J-1,AD}} \oplus \mathit{W_{J-1,DA}} \oplus \mathit{W_{J-1,DD}}\]
或是特徵頻率如圖六

\[\mathit{V_J} = \mathit{V_{J-1}} \oplus \mathit{W_{J-1,A}} \oplus \mathit{W_{J-1,DA}} \oplus \mathit{W_{J-1,DD}}\]
[WTTP7.png](https://zh.wikipedia.org/wiki/File:WTTP7.png "fig:WTTP7.png")
一般而言，對於\(\mathit{P}\)-階、一維的小波包

\[\mathit{D(P+1)}\] = \(\mathit{[D(P)]^2} + 1\) 種的分解方式，其中

\[\mathit{D(1)} = 1\] 有這麼多種的分解方式下，小波包轉換進一步提供分解特徵頻率的的精細度，但分解越精細，複雜度也隨之而增。

## 二維多階小波包分解

在二維時，一次小波轉換會得到四個區域，三個子空間(圖七)，分別為\(\mathit{V_{J-1}}\)低頻訊號；\(\mathit{W_{J-1}^H}\)，水平特徵；\(\mathit{W_{J-1}^V}\)，垂直特徵；\(\mathit{W_{J-1}^D}\)，角落特徵。
[WTTP8.png](https://zh.wikipedia.org/wiki/File:WTTP8.png "fig:WTTP8.png")
圖八為三階的分析樹
[WTTP9.png](https://zh.wikipedia.org/wiki/File:WTTP9.png "fig:WTTP9.png")
與一維類似，\(\mathit{W_{J-1,VD}^H}\)為例，是第\(\mathit{J-1}\)階快速小波轉換的水平細節係數(\(\mathit{W_{J-1}^H}\))經過"細節/近似"濾波器後(\(\mathit{W_{J-1,V}^H}\))，再經過"細節/細節"濾波器(\(\mathit{W_{J-1,VD}^H}\))。
一個\(\mathit{P}\)-階的二維小波包分解有

\[\mathit{D(P+1)}\] = \(\mathit{[D(P)]^4} + 1\)種，其中

\[\mathit{D(1)} = 1\] 因此圖八有83522種分解的方式。

## 分解準則

由上述的例子可知道小波包分解的可能方式有很多種選擇，在應用上不夠實際，需要一套有效的演算法找最佳的分解方式，在壓縮上更有效率。以下用一張指紋影像(圖九)來說明，利用熵準則判斷二進位樹(binary
tree)。
[WTTP10.png](https://zh.wikipedia.org/wiki/File:WTTP10.png "fig:WTTP10.png")
[WTTP11.png](https://zh.wikipedia.org/wiki/File:WTTP11.png "fig:WTTP11.png")
我們將圖九的影像用完整二維三階的小波包分解後會得到圖十的結果，其分析樹如圖八所表示，總共有64個子空間。這樣完整的分解，壓縮效率並不一定是最好的。
利用一個合理的準則來選擇在那些節點要繼續做小波分解，稱為可加性消耗函數(additive cost function)

\[\mathit{E(f)} = \sum_{m,n} |f(m,n)|\]
此函數量測二維訊號\(\mathit{f}\)的熵，熵值若趨近於零，所攜帶的資訊量越少；熵值越高，表示非零的值越多，然而當零的值越多，能使壓縮效率提高，將可加性消耗函數的值最小化即是分解的最佳方式。
以下兩步驟是取得最佳分解方式的演算法:

  -
    1.計算預估計節點的熵，以\(\mathit{E_P}\)表示，經過一次二維小波包轉換的四個區域的熵分別為

\(\mathit{E_A}\),\(\mathit{E_H}\),\(\mathit{E_V}\),\(\mathit{E_D}\)。

  -
    2.比較四個區域熵的和是否小於原本節點的熵，即\(\mathit{E_A}\) + \(\mathit{E_H}\) +
    \(\mathit{E_V}\) + \(\mathit{E_D}\) \<
    \(\mathit{E_P}\)。若和大於等於原節點的值就刪去其分支，不要往下做小波分解。

上述的演算法可減少分析樹的分支，減少運算複雜度，並得到最佳化的分解方式。圖十一是將圖九的影像經過該演算法所產生，與圖十比較可發現在高頻的部分沒繼續分解，使壓縮效率最高。
[WTTP12.png](https://zh.wikipedia.org/wiki/File:WTTP12.png "fig:WTTP12.png")

## 同時參閱

  - [小波分析](../Page/小波分析.md "wikilink")
  - [快速小波轉換](../Page/快速小波轉換.md "wikilink")（FWT）

## 參考

  - Rafael C. Gonzalez, Richard E. Woods, "Digital Image Processing",
    2nd 2002, ISBN 0-20-118075-8
  - Mallat Stéphane, "A Wavelet Tour of Signal Processing ", 3rd 2009,
    ISBN 978-0-12-374370-1

[Category:圖像處理](https://zh.wikipedia.org/wiki/Category:圖像處理 "wikilink")
[Category:小波分析](https://zh.wikipedia.org/wiki/Category:小波分析 "wikilink")
**快照隔离**（snapshot
isolation）是数据库事务处理中的一个隔离级别，保证事务的读操作将看到一个一致的数据库的版本快照（实际上读取比该事务早的最后一次提交值），写操作成功提交的前提是没有对该快照并发修改冲突。

很多重要的[数据库管理系统已经采用了快照隔离](../Page/数据库管理系统.md "wikilink")，如[InterBase](https://zh.wikipedia.org/wiki/InterBase "wikilink"),
[Firebird](../Page/Firebird_\(数据库\).md "wikilink"),
[Oracle](https://zh.wikipedia.org/wiki/Oracle_database "wikilink"),
[MySQL](../Page/MySQL.md "wikilink")\[1\],
[PostgreSQL](../Page/PostgreSQL.md "wikilink"), ,
[MongoDB](../Page/MongoDB.md "wikilink")\[2\] 与 [Microsoft SQL
Server](https://zh.wikipedia.org/wiki/Microsoft_SQL_Server "wikilink")
(从2005)。原因是快照隔离比[可顺序化隔离级别的性能更好](https://zh.wikipedia.org/wiki/可顺序化 "wikilink")，且仍仍避免绝大多数并发异常。快照隔离一般用[多版本并发控制](../Page/多版本并发控制.md "wikilink")(MVCC)实现。

## 定义

事务在启动时得到一个数据库的版本号。事务结束时，成功提交仅当它修改的快照的数据项没有被外界改变，即没有，否则事务流产（abort）。

## 写偏斜

**写偏斜**（write skew）异常，是指两个事务(T1与T2)并发写一个数据集(例如包含 V1 与 V2)不相交的数据项(例如 T1
修改 V1, T2 修改 V2)，最后并发提交事务。如果事物是串行执行，这种异常不会发生。而快照隔离允许这种异常发生。

例如，设想 V1 与 V2是 Phil的个人银行账户。银行允许V1或V2是空头账户，只要两个账户总和非负(即 V1 + V2 ≥ 0).
两个户头的初值各是 $100. Phil启动两个事务，T1从V1取出$200，T2从V2取出$200.

## 历史

快照隔离源自[多版本并发控制数据库](../Page/多版本并发控制.md "wikilink")。\[3\]
[InterBase](https://zh.wikipedia.org/wiki/InterBase "wikilink")，后来被[Borland所有](../Page/Borland.md "wikilink")，从1985年版本4开始提供了SI\[4\]\[5\].

ANSI
[SQL-92标准基于数据库锁机制](https://zh.wikipedia.org/wiki/SQL-92 "wikilink")，对MVCC系统缺乏认识。\[6\]

2008年Cahill等人的论文指出写偏斜异常可通过检测并流产危险的并发任务群解决。\[7\]已经被PostgreSQL
9.1采用\[8\]\[9\]\[10\] 这被称作"Serializable Snapshot Isolation", SSI.

2011,
Jimenez-Peris等人申报专利\[11\]可以解决每秒上千万次事务提交的快照隔离，成为超大规模并发数据库引擎LeanXcale的基础
\[12\]. 2010成为CumuloNimbo European Project的部分 \[13\].

## 参考文献

<references/>

## 进一步阅读

  - Bettina Kemme , Gustavo Alonso, [A new approach to developing and
    implementing eager database replication
    protocols](http://doi.acm.org/10.1145/363951.363955), ACM
    Transactions on Database Systems (TODS), v.25 n.3, p.333-379, Sept.
    2000.
  - Gerhard Weikum, Gottfried Vossen, *Transactional information
    systems: theory, algorithms, and the practice of concurrency control
    and recovery*, Morgan Kaufmann, 2002,
  - Yi Lin, Bettina Kemme, Marta Patiño-Martínez, Ricardo Jiménez-Peris.
    [Middleware based data replication providing snapshot
    isolation](https://doi.org/10.1145/1066157.1066205). Proceedings of
    the 2005 ACM SIGMOD international Conf., 2005.
  - Marta Patiño-Martinez, Ricardo Jiménez-Peris, Bettina Kemme, Gustavo
    Alonso. [MIDDLE-R: Consistent database replication at the middleware
    level](https://doi.org/10.1145/1113574.1113576). ACM Transactions on
    Computer Systems (TOCS). Volume 23 Issue 4. Pages 375-423.
  - Khuzaima Daudjee, Kenneth Salem, *Lazy Database Replication with
    Snapshot Isolation*, VLDB 2006: pages 715-726

[Category:数据库](https://zh.wikipedia.org/wiki/Category:数据库 "wikilink")
[Category:并发控制](https://zh.wikipedia.org/wiki/Category:并发控制 "wikilink")
[Category:事务处理](https://zh.wikipedia.org/wiki/Category:事务处理 "wikilink")

1.

2.  Multiversion concurrency control in MongoDB, [MongoDB CTO: How our
    new WiredTiger storage engine will earn its
    stripes](http://www.zdnet.com/article/mongodb-cto-how-our-new-wiredtiger-storage-engine-will-earn-its-stripes/)

3.
4.
5.

6.
7.  Michael J. Cahill, Uwe Röhm, Alan D. Fekete (2008) ["Serializable
    isolation for snapshot
    databases"](http://portal.acm.org/citation.cfm?id=1376690),
    *Proceedings of the 2008 ACM SIGMOD international conference on
    Management of data*, pp. 729–738,  (SIGMOD 2008 best paper award)

8.
9.
10.

11.

12.

13.
**控制变量法**（）是在[蒙特卡洛方法中用于减少](https://zh.wikipedia.org/wiki/蒙特卡洛方法 "wikilink")[方差的一种技术方法](../Page/方差.md "wikilink")。该方法通过对已知量的了解来减少对未知量估计的误差。

## 原理

假设要估计的参数为\(\mu\)。同时对于统计\(m\)，其[期望值为](../Page/期望值.md "wikilink")\(\mu\)：\(\mathbb{E}\left[m\right]=\mu\)，即\(m\)是\(\mu\)的[无偏差估计](../Page/估计量的偏差.md "wikilink")。此时，对于另一个统计\(t\)，已知\(\mathbb{E}\left[t\right]=\tau\)。于是，

\[m^\star = m + c\left(t-\tau\right) \,\]

也是\(\mu\)的无偏差估计，\(c\)为任一给定系数。\(m^\star\)的方差为

\[\textrm{Var}\left(m^{\star}\right)=\textrm{Var}\left(m\right) + c^2\,\textrm{Var}\left(t\right) + 2c\,\textrm{Cov}\left(m,t\right);\]

可以证明，使得方差最小的系数\(c\)为

\[c^\star = - \frac{\textrm{Cov}\left(m,t\right)}{\textrm{Var}\left(t\right)};\]

此时，对应的方差则为

\[\begin{align}
\textrm{Var}\left(m^{\star}\right) & =\textrm{Var}\left(m\right) - \frac{\left[\textrm{Cov}\left(m,t\right)\right]^2}{\textrm{Var}\left(t\right)} \\
& = \left(1-\rho_{m,t}^2\right)\textrm{Var}\left(m\right);
\end{align}\]

其中

\[\rho_{m,t}=\textrm{Corr}\left(m,t\right)\,\]
为\(m\)与\(t\)之间的[相关系数](../Page/皮尔逊积矩相关系数.md "wikilink")。\(\vert\rho_{m,t}\vert\)越大时，方差越小。

当\(\textrm{Cov}\left(m,t\right)\)、\(\textrm{Var}\left(t\right)\)或\(\rho_{m,t}\;\)未知时，可以通过蒙特卡洛模拟进行估计。由于该方法相当于一个[最小二乘法系统](../Page/最小二乘法.md "wikilink")，又被称为**回归抽样**（）。

## 示例

假设我们要使用蒙特卡洛方法估计

\[I = \int_0^1 \frac{1}{1+x} \, \mathrm{d}x,\]

即估计

\[f(U) = \frac{1}{1+U}\]

的期望值。其中，\(U\)满足[均匀分布](https://zh.wikipedia.org/wiki/连续型均匀分布 "wikilink")。假设有*n*个[样本](https://zh.wikipedia.org/wiki/样本 "wikilink")\(u_1, \cdots, u_n\)，该估计可表示为

\[I \approx \frac{1}{n} \sum_i f(u_i);\]

此时，我们引入控制变量\(g(U) = 1+U\)，其已知期望值为\(\mathbb{E}\left[g\left(U\right)\right]=\int_0^1 (1+x) \, \mathrm{d}x=\tfrac{3}{2}\)。由此，可以得到新的估计

\[I \approx \frac{1}{n} \sum_i f(u_i)+c\left(\frac{1}{n}\sum_i g(u_i) -3/2\right).\]

以下为\(n=1500\)并使用估计的最优系数\(c^\star \approx 0.4773\)时，一次蒙特卡洛模拟所给出的积分估计值：

|       |         |         |
| ----- | ------: | ------: |
|       |  **估计** | **标准差** |
| 普通模拟  | 0.69475 | 0.01947 |
| 控制变量法 | 0.69295 | 0.00060 |

## 参考文献

  - Ross, Sheldon M. (2002) *Simulation* 3rd edition
  - Averill M. Law & W. David Kelton (2000), *Simulation Modeling and
    Analysis*, 3rd edition.
  - S. P. Meyn (2007) *Control Techniques for Complex Networks*,
    Cambridge University Press. . [Downloadable
    draft](https://web.archive.org/web/20100619011046/https://netfiles.uiuc.edu/meyn/www/spm_files/CTCN/CTCN.html)
    (Section 11.4: Control variates and shadow functions)

[Category:蒙地卡罗方法](https://zh.wikipedia.org/wiki/Category:蒙地卡罗方法 "wikilink")
[Category:计算统计学](https://zh.wikipedia.org/wiki/Category:计算统计学 "wikilink")
**梅森旋转演算法**（**Mersenne
twister**）是一个[伪随机数发生算法](../Page/伪随机数发生算法.md "wikilink")。由[松本真和](../Page/松本真.md "wikilink")[西村拓士](../Page/西村拓士.md "wikilink")\[1\]在1997年开发，基于有限[二进制](../Page/二进制.md "wikilink")[字段上的](../Page/字段.md "wikilink")[矩阵线性递归](../Page/矩阵线性递归.md "wikilink")\(F_{2}\)。可以快速产生高质量的伪随机数，修正了古典随机数发生算法的很多缺陷。

Mersenne
Twister这个名字来自周期长度取自[梅森素数的这样一个事实](../Page/梅森素数.md "wikilink")。这个算法通常使用两个相近的变体，不同之处在于使用了不同的梅森素数。一个更新的和更常用的是MT19937,
32位字长。还有一个变种是64位版的MT19937-64。对于一个*k*位的长度，Mersenne
Twister会在\([0,2^k-1]\)的区间之间生成[离散型均匀分布的随机数](../Page/离散型均匀分布.md "wikilink")。

## 应用

梅森旋转算法是[R](../Page/R.md "wikilink")、[Python](../Page/Python.md "wikilink")、[Ruby](../Page/Ruby.md "wikilink")、[IDL](../Page/IDL.md "wikilink")、[Free
Pascal](../Page/Free_Pascal.md "wikilink")、[PHP](../Page/PHP.md "wikilink")、[Maple](../Page/Maple.md "wikilink")、[Matlab](../Page/Matlab.md "wikilink")、[GNU多重精度运算库和GSL的默认伪随机数产生器](../Page/GNU多重精度运算库.md "wikilink")。从C++11开始，C++也可以使用这种算法。在Boost
C++,Glib和NAG数值库中，作为插件提供。

在SPSS中，梅森旋转算法是两个PRNG中的一个：另一个是产生器仅仅为保证旧程序的兼容性，梅森旋转被描述为“更加可靠”。梅森旋转在SAS中同样是PRNG中的一个，另一个产生器是旧时的且已经被弃用。

## 优点

最为广泛使用Mersenne Twister的一种变体是MT19937，可以产生32位整数序列。具有以下的优点：

1.  周期非常长，达到2<sup>19937</sup>−1。尽管如此长的周期并不必然意味着高质量的伪随机数，但短周期（比如许多旧版本软件包提供的2<sup>32</sup>）确实会带来许多问题。\[2\]
2.  在1 ≤ *k* ≤ 623的维度之间都可以均等分布（参见定义）。
3.  除了在统计学意义上的不正确的随机数生成器以外，在所有伪随机数生成器法中是最快的（当时）\[3\]

## 缺点

为了性能，这个算法付出了巨大的空间成本（当时而言）：需要 2.5 [KiB](../Page/KiB.md "wikilink")
的[缓存空间](../Page/memory_hierarchy.md "wikilink")。2011年，[松本真和](../Page/松本真.md "wikilink")[西村拓士针对这一问题提出了一个更小的版本](../Page/西村拓士.md "wikilink")，仅占127
bits的 TinyMT （Tiny Mersenne Twister）。\[4\]

## *k*-分布

## 其他选择

## 算法详细

整个算法主要分为三个阶段：

第一阶段：获得基础的梅森旋转链；

第二阶段：对于旋转链进行旋转算法；

第三阶段：对于旋转算法所得的结果进行处理；

算法实现的过程中，参数的选取取决于梅森素数，故此得名。

## 相关代码

下面的一段[伪代码使用MT](../Page/伪代码.md "wikilink")19937算法生成范围在\[0,
2<sup>32</sup> − 1\]的均匀分布的32位整数：

### 伪代码

` `*`//创建一个长度为624的数组来存储发生器的状态`*
` `**`int`**`[0..623] MT`
` `**`int`**` index = 0`
` `
` `*`//用一个种子初始化发生器`*
` `**`function`**` initialize_generator(`**`int`**` seed) {`
`     i := 0`
`     MT[0] := seed`
`     `**`for`**` i `**`from`**` 1 `**`to`**` 623 { `*`//``
 ``遍历剩下的每个元素`*
`         MT[i] := `**`last``   ``32``   ``bits``
 ``of`**`(1812433253 * (MT[i-1] `**[`xor`](../Page/位操作#按位异或\(XOR\).md "wikilink")**` (`**`right``
 ``shift``   ``by``   ``30``   ``bits`**`(MT[i-1]))) + i) `*`//``
 ``1812433253``   ``==``   ``0x6c078965`*
`     }`
` }`
` `
` `*`//``   ``Extract``   ``a``   ``tempered``   ``pseudorandom``
 ``number``   ``based``   ``on``   ``the``   ``index-th``   ``value,`*
` `*`//``   ``calling``   ``generate_numbers()``   ``every``   ``624``
 ``numbers`*
` `**`function`**` extract_number() {`
`     `**`if`**` index == 0 {`
`         generate_numbers()`
`     }`
` `
`     `**`int`**` y := MT[index]`
`     y := y `**`xor`**` (`**`right``   ``shift``   ``by``   ``11``
 ``bits`**`(y))`
`     y := y `**`xor`**` (`**`left``   ``shift``   ``by``   ``7``
 ``bits`**`(y) `**[`and`](../Page/位操作#按位与\(AND\).md "wikilink")**` (2636928640)) `*`//``
 ``2636928640``   ``==``   ``0x9d2c5680`*
`     y := y `**`xor`**` (`**`left``   ``shift``   ``by``   ``15``
 ``bits`**`(y) `**`and`**` (4022730752)) `*`//``   ``4022730752``
 ``==``   ``0xefc60000`*
`     y := y `**`xor`**` (`**`right``   ``shift``   ``by``   ``18``
 ``bits`**`(y))`

`     index := (index + 1) `**[`mod`](../Page/模除.md "wikilink")**` 624`
`     `**`return`**` y`
` }`
` `
` `*`//``   ``Generate``   ``an``   ``array``   ``of``   ``624``
 ``untempered``   ``numbers`*
` `**`function`**` generate_numbers() {`
`     `**`for`**` i `**`from`**` 0 `**`to`**` 623 {`
`         `**`int`**` y := (MT[i] & 0x80000000)                       // bit 31 (32nd bit) of MT[i]`
`                        + (MT[(i+1) `**`mod`**` 624] & 0x7fffffff)   // bits 0-30 (first 31 bits) of MT[...]`
`         MT[i] := MT[(i + 397) `**`mod`**` 624] `**`xor`**` (`**`right``
 ``shift``   ``by``   ``1``   ``bit`**`(y))`
`         `**`if`**` (y `**`mod`**` 2) != 0 { `*`//``   ``y``   ``is``
 ``odd`*
`             MT[i] := MT[i] `**`xor`**` (2567483615) `*`//``
 ``2567483615``   ``==``   ``0x9908b0df`*
`         }`
`     }`
` }`

### Python 代码

``` python
def _int32(x):
    return int(0xFFFFFFFF & x)

class MT19937:
    def __init__(self, seed):
        self.mt = [0] * 624
        self.mt[0] = seed
        for i in range(1, 624):
            self.mt[i] = _int32(1812433253 * (self.mt[i - 1] ^ self.mt[i - 1] >> 30) + i)


    def extract_number(self):
        self.twist()
        y = self.mt[0]
        y = y ^ y >> 11
        y = y ^ y << 7 & 2636928640
        y = y ^ y << 15 & 4022730752
        y = y ^ y >> 18
        return _int32(y)


    def twist(self):
        for i in range(0, 624):
            y = _int32((self.mt[i] & 0x80000000) + (self.mt[(i + 1) % 624] & 0x7fffffff))
            self.mt[i] = y ^ self.mt[(i + 397) % 624] >> 1

            if y % 2 != 0:
                self.mt[i] = self.mt[i] ^ 0x9908b0df
```

调用函数 `MT19937(`*`seed`*`).extract_number()` 将会返回随机数，其中 *`seed`* 是已确定的种子。

## SFMT

### 实现

  - [XLL Excel Addin Implementation of mersenne twister random number
    generator](http://www.pimpmyexcel.com/)
  - [Two implementations of Mersenne Twister in Java: one is the fastest
    known, and the other is a drop-in replacement for
    java.util.Random](http://www.cs.gmu.edu/~sean/research/)
  - [The GNU Scientific Library (GSL), containing an implementation of
    the Mersenne Twister](http://www.gnu.org/software/gsl/)
  - [C++ and binary function libraries for several platforms.
    Multithreaded. Includes Mersenne Twister and
    SFMT](http://www.agner.org/random/)
  - [Implementations of the Mersenne Twister in C and
    C++](http://www.cs.hmc.edu/~geoff/mtwist.html)
  - [Implementation of the Mersenne Twister in
    C++](https://web.archive.org/web/20080820051549/http://www-personal.engin.umich.edu/~wagnerr/MersenneTwister.html)
  - [Implementation of the Mersenne Twister in
    C++](https://web.archive.org/web/20100319165118/http://babel.isa.uma.es/mrpt/index.php/Example:Random_number_generation)
    within the [Mobile Robot Programming
    Toolkit](../Page/Mobile_Robot_Programming_Toolkit.md "wikilink")
  - [Implementation of Mersenne Twister as an add-in for Microsoft
    Excel](http://www.ntrand.com/)
  - [Implementation of Mersenne Twister as a free module for Visual
    Basic (Microsoft Excel, Microsoft Access and VB compilers) and for
    other Basic versions in the official site of the Mersenne
    Twister](http://www.math.sci.hiroshima-u.ac.jp/~m-mat/MT/VERSIONS/BASIC/basic.html)
  - [Implementation of Mersenne Twister for REALbasic (requires
    REALbasic 2006r1 or
    greater)](https://web.archive.org/web/20080218152740/http://www.aaronballman.com/programming/REALbasic/Rand.php)
  - [Implementation of Mersenne Twister for
    Lisp](https://web.archive.org/web/20100210230709/http://cybertiggyr.com/gene/jmt/)
  - [Implementation of Mersenne Twister in
    Euphoria](https://web.archive.org/web/20110715154716/http://www.rapideuphoria.com/mt.zip)
  - [Implementation of Mersenne Twister for C\# (newer, System.Random
    drop-in
    replacement)](http://code.msdn.microsoft.com/MersenneTwister)
    ([Older
    implementation](https://web.archive.org/web/20070110182320/http://www.c-sharpcorner.com/Code/2003/April/MersenneTwisterAlgo.asp))
  - [Implementation of Mersenne Twister for
    Ada](https://web.archive.org/web/20100508091716/http://adrianhoe.com/adrianhoe/projects/adamt19937/)
  - [Implementation of Mersenne Twister for
    Fortran 95](https://web.archive.org/web/20100411090930/http://www.coyotegulch.com/products/libcoyotl/twisted_road/index.html)
  - [Implementation of Mersenne Twister for
    Mathematica](https://web.archive.org/web/20090110142338/http://modp.com/release/mma_mersenne_twister/)
  - [Implementation of Mersenne Twister for
    MATLAB](http://www.mathworks.com/matlabcentral/fileexchange/loadFile.do?objectId=6614&objectType=file)
  - [Implementation of Mersenne Twister for
    Mitrion-C](http://www.mitrionics.com/?page=page49058d1d215e8)
  - [Implementation of Mersenne Twister for
    Clean](https://web.archive.org/web/20100410193201/http://clean.cs.ru.nl/Download/Download_Libraries/mt/body_mt.html)
  - [High-speed Implementation of Mersenne
    Twister](http://herbert.gandraxa.com/herbert/rng.asp) in
    [Linoleum](../Page/Linoleum_programming_language.md "wikilink") (a
    cross-platform
    [Assembler](../Page/Assembly_language.md "wikilink")), by Herbert
    Glarner
  - [CPAN module implementing the Mersenne Twister for use with
    Perl](http://search.cpan.org/search?module=Math%3A%3ARandom%3A%3AMT%3A%3AAuto)
  - [Implementation of Mersenne Twister for
    Haskell](http://www.augustsson.net/Darcs/MT/)
  - [Implementation of Mersenne Twister for Standard
    ML](https://web.archive.org/web/20080927225229/http://mlton.org/cgi-bin/viewsvn.cgi/mltonlib/trunk/org/mlton/ville/mersenne-twister/unstable/)
  - [Implementation of Mersenne Twister in
    F\#](https://web.archive.org/web/20091010234544/http://mbishop.esoteriq.org/code/Fsharp/mt.fs)
  - It also is implemented in [gLib](../Page/gLib.md "wikilink") and the
    standard libraries of at least [PHP](../Page/PHP.md "wikilink"),
    [Python](../Page/Python.md "wikilink") and
    [Ruby](../Page/Ruby_programming_language.md "wikilink").
  - [RandomLib](http://randomlib.sourceforge.net) C++ library
    implementing Mersenne Twister and SFMT.
  - [C++ implementation of Mersenne Twister for the IBM/Sony Cell
    Broadband Engine (Cell BE) specialized processing
    units](https://web.archive.org/web/20081225142451/http://adam.ierymenko.name/files/MersenneTwister32_spe.cpp)
  - [Mersenne Twister ported to
    ActionScript](https://web.archive.org/web/20100227093329/http://flashexperiments.insh-allah.com/#Mersenne_Twister_ported_to_ActionScript)
  - [Mersenne Twister in
    Clojure](http://www.hackinghat.com/index.php/lisp/mersenne-twister-in-clojure)
  - [Implementation of Mersenne Twister for
    ABAP](http://help.sap.com/abapdocu_70/en/ABENCL_ABAP_MATH.htm)

## 参考列表

## 外部链接

  - [The academic paper for MT, and related articles by Makoto
    Matsumoto](http://www.math.sci.hiroshima-u.ac.jp/~m-mat/MT/ARTICLES/earticles.html)
  - [Mersenne Twister home page, with codes in C, Fortran, Java, Lisp
    and some other
    languages](http://www.math.sci.hiroshima-u.ac.jp/~m-mat/MT/emt.html)
  - [SIMD-oriented Fast Mersenne Twister
    (SFMT)](http://www.math.sci.hiroshima-u.ac.jp/~m-mat/MT/SFMT/index.html)

[Category:随机数生成](https://zh.wikipedia.org/wiki/Category:随机数生成 "wikilink")
[Category:带有伪代码示例的条目](https://zh.wikipedia.org/wiki/Category:带有伪代码示例的条目 "wikilink")

1.
2.  注：2<sup>19937</sup>约等于4.3×10<sup>6001</sup>，这个值比[可观测宇宙内粒子总数的估计值](../Page/可觀測宇宙.md "wikilink")（10<sup>87</sup>）还要高出上千个数量级。
3.  P. L'Ecuyer and R. Simard, \`\`TestU01: A C Library for Empirical
    Testing of Random Number Generators'', ACM Transactions on
    Mathematical Software, 33, 4, Article 22, August 2007.
4.
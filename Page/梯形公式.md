[trapezoidal_rule_illustration.png](https://zh.wikipedia.org/wiki/File:trapezoidal_rule_illustration.png "fig:trapezoidal_rule_illustration.png")[函數](https://zh.wikipedia.org/wiki/函數 "wikilink")（紅色）會作用估算[函數](https://zh.wikipedia.org/wiki/函數 "wikilink")\(f(x)\) （藍色）。\]\]

**梯形公式**是[數學中](https://zh.wikipedia.org/wiki/數學 "wikilink")[数值积分的基础公式之一](https://zh.wikipedia.org/wiki/数值积分 "wikilink")：\(\int_{a}^{b} f(x)\, dx \approx (b-a)\frac{f(a) + f(b)}{2}.\)

## 公式由来

由[积分中值定理可得](https://zh.wikipedia.org/wiki/积分中值定理 "wikilink")

\(\exists \xi \in [a,b]  \int\limits_{a}^{b} f(x) dx = (b-a)f(\xi)\)，

但由于ξ其值一般难于确定，故难以准确算出f(ξ)的值。

如果用两端点f(a)与f(b)的[算术平均值估算f](https://zh.wikipedia.org/wiki/算术平均值 "wikilink")(ξ)，有

\(\int\limits_{a}^{b} f(x) dx \approx \frac{b-a}{2}[f(a)+f(b)]\)，

这就是梯形公式。

类似地，如果用区间中点\(c=\frac{a+b}{2}\)其高度f(c)取代f(ξ)，从而有**中矩形公式**

\(\int\limits_{a}^{b} f(x) dx \approx (b-a)f(\frac{a+b}{2})\)。

## 复合求积公式

### 每一區間相同

[Trapezoidal_rule_illustration_small.svg](https://zh.wikipedia.org/wiki/File:Trapezoidal_rule_illustration_small.svg "fig:Trapezoidal_rule_illustration_small.svg") 為了計算出更加準確的[定積分](https://zh.wikipedia.org/wiki/定積分 "wikilink")，可以把[積分的區間](https://zh.wikipedia.org/wiki/積分 "wikilink")\([a, b]\)分成\(N\)份，當中\(N\)趨向[無限](https://zh.wikipedia.org/wiki/無限 "wikilink")，分割出的每一個區間長度必定要是一樣的，然後就可以應用梯形公式：

\[\int_a^b f(x)\,dx \approx \frac{b-a}{N} \left[ {f(a) + f(b) \over 2} + \sum_{k=1}^{N-1} f \left( a+k \frac{b-a}{N} \right) \right].\]

亦可以寫成：

\[\int_a^b f(x)\,dx \approx \frac{b-a}{2N} \left(f(x_0) + 2f(x_1) + 2f(x_2)+\cdots+2f(x_{N-1}) + f(x_N) \right)\]

當中

  -
    \(x_k=a+k \frac{b-a}{N},\text{ for }k=0, 1, \dots, N\)

其余项为

\(R_n(f)=-\frac{b-a}{12}h^2f''(\eta) , \eta \in (a,b)\)

當區間的長度並不相同時，這一條公式便不能使用。

### 每一區間並不相同

[Composite_trapezoidal_rule_illustration.png](https://zh.wikipedia.org/wiki/File:Composite_trapezoidal_rule_illustration.png "fig:Composite_trapezoidal_rule_illustration.png")

給予\(x_1,\ldots,x_N\)以及\(y_1,\ldots,y_N\)，[定積分就可以估算成](https://zh.wikipedia.org/wiki/定积分 "wikilink")

\[\int_a^b f(x)\,dx \approx \frac{1}{2} \sum_{i=2}^{N} (x_i-x_{i-1})(y_i+y_{i-1})\],

當中

\[y_i=f(x_i)\].

## 誤差分析

應用梯形公式的誤差值是真值數字與運用梯形公式結果的差異：

\[\text{error} = \int_a^b f(x)\,dx - \frac{b-a}{N} \left[ {f(a) + f(b) \over 2} + \sum_{k=1}^{N-1} f \left( a+k \frac{b-a}{N} \right) \right]\]

如果 *(a*, *b)* 中存在一個實數*ξ*，那麼

\[\text{error} = -\frac{(b-a)^3}{12N^2} f''(\xi)\]

对于中矩形公式，其误差类似的有：

\(\text{error} = -\frac{(b-a)^3}{24} f''(\xi)\)

如果[被積函數是一個](https://zh.wikipedia.org/wiki/被積函數 "wikilink")[凸函數](https://zh.wikipedia.org/wiki/凸函數 "wikilink")（亦即有一個正值[二階導數](https://zh.wikipedia.org/wiki/二階導數 "wikilink")），那麼誤差會是一個負數，也代表梯形公式的估算值高估了真實數字。這可以利用一個幾何圖形代去表達：梯形不但覆蓋曲線下的面積更超越其範圍。同樣地，如果被積函數是一個[凹函數](https://zh.wikipedia.org/wiki/凹函數 "wikilink")，梯形公式就會低估其真實數字因為曲線下部份面積沒有被計算在內。如果被積函數中有[拐點](https://zh.wikipedia.org/wiki/拐點 "wikilink")。它的錯誤是比較難去估計。

一般而言有數種方法可以去分析誤差，例如是：[傅利葉級數](https://zh.wikipedia.org/wiki/傅利葉級數 "wikilink")。

在*N* → ∞的情況下，趨向性的估計誤差是：

\[\text{error} = -\frac{(b-a)^2}{12N^2} \big[ f'(b)-f'(a) \big] + O(N^{-3}).\]

## 参考文献

  - 《数值分析》，清华大学出版社，李庆扬等编，书号ISBN 978-7-302-18565-9

[Category:数值积分](https://zh.wikipedia.org/wiki/Category:数值积分 "wikilink")
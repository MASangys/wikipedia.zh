[Meltdown_logo_with_text.svg](https://zh.wikipedia.org/wiki/File:Meltdown_logo_with_text.svg "fig:Meltdown_logo_with_text.svg")  **-{zh-cn:熔断;zh-tw:熔毁;zh-hk:熔毁;}-**（），也译**崩溃**\[1\]，编号，正式名稱爲「」，常譯作「**恶意数据缓存加载**」\[2\]\[3\]，是一个存在于[英特爾大部分x86/x86-64微处理器](../Page/英特尔微处理器列表.md "wikilink")、部分[IBM POWER架構處理器以及部分](../Page/IBM_POWER.md "wikilink")[ARM架構處理器中的關於](https://zh.wikipedia.org/wiki/ARM架構 "wikilink")[推測執行機制的](https://zh.wikipedia.org/wiki/推測執行 "wikilink")[硬件设计缺陷及安全漏洞](https://zh.wikipedia.org/wiki/计算机安全隐患 "wikilink")\[4\]\[5\]\[6\]。该缺陷使得低權限的[进程無論是否](https://zh.wikipedia.org/wiki/进程 "wikilink")[取得特權](https://zh.wikipedia.org/wiki/权限提升 "wikilink")，均可以獲取受高權限保護的[内存空間中的資料](../Page/虚拟内存.md "wikilink")，[漏洞利用是基於時間的](https://zh.wikipedia.org/wiki/漏洞利用 "wikilink")[旁路攻擊](https://zh.wikipedia.org/wiki/旁路攻擊 "wikilink")。2018年1月，该缺陷隨另一個基於推測執行機制的重量級資訊安全漏洞、硬體缺陷「Spectre」（[幽靈](https://zh.wikipedia.org/wiki/幽灵_\(安全漏洞\) "wikilink")）在[通用漏洞披露中公布](https://zh.wikipedia.org/wiki/通用漏洞披露 "wikilink")。

由於英特爾處理器及IBM POWER處理器均在市場上佔據極大的份額（出現缺陷的ARM處理器在缺陷被發現時尚未正式面市），這種涉及資訊安全的硬體缺陷影響範圍甚廣，包括幾乎整個x86、POWER[伺服器領域](https://zh.wikipedia.org/wiki/伺服器 "wikilink")、幾乎整個[小型主機及](https://zh.wikipedia.org/wiki/小型机 "wikilink")[大型主機市場](https://zh.wikipedia.org/wiki/大型主機 "wikilink")、[個人電腦市場等都無一倖免](https://zh.wikipedia.org/wiki/個人電腦 "wikilink")，\[7\]另外該缺陷的危險程度之高（無需特權即可存取敏感資料所在的記憶體空間），曾一度令資安人員及機構懷疑缺陷的真實性，而提前公佈這些缺陷還極有可能引發全球性的資安災難，因而選擇先與處理器廠商及核心客戶聯絡協商備妥修補方案再另行公佈。\[8\]\[9\]\[10\]\[11\]目前該硬體缺陷可通過軟體實作規避，包括Linux系、Android、OS X/macOS、Windows等等都有相應的修復程式（像是Linux的[内核页表隔离](../Page/内核页表隔离.md "wikilink")技術）\[12\]\[13\]\[14\]，但是軟體規避將導致處理器效能的顯著下降。\[15\]而從根本上修復該缺陷的方法（包括修復「幽靈」缺陷）是重新設計處理器的微架構，爲此英特爾、IBM及ARM都將新處理器微架構的推出時程大幅押後。\[16\]\[17\]\[18\]\[19\]

## 概述

熔毀缺陷是基於設計不良的[數位電路設計中出現的](https://zh.wikipedia.org/wiki/數位電路 "wikilink")[竞争条件](https://zh.wikipedia.org/wiki/竞争冒险 "wikilink")，再結合許多現代[微處理器的](https://zh.wikipedia.org/wiki/微處理器 "wikilink")[非依序執行及](../Page/乱序执行.md "wikilink")[推測執行特性而產生](https://zh.wikipedia.org/wiki/推測執行 "wikilink")。\[20\]

在具備非依序執行及推測執行特性的處理器上，處理器會檢測[指令的相依性](https://zh.wikipedia.org/wiki/指令 "wikilink")，對無相依性的指令會進行預先執行，或者當處理器執行某一指令出現異常而面臨停頓時，處理器會先執行與異常指令無相依性的指令以跳過停頓，這兩類指令執行方式的執行結果都會保存到CPU快取上一段時間以備使用（超過時間即拋棄結果），這些預測執行的動作包括分支预测，预读取，推测性内存访问，缓存缺失的重叠/乱序处理（MSHR）等等。\[21\]

某行程的某條指令需要其指定某個記憶體位址的資料進行運算，基於[CPU快取的機制](https://zh.wikipedia.org/wiki/CPU快取 "wikilink")，該筆資料會先載入至CPU快取上，而這個過程對於指令而言是透明的，因此其它行程是無法直接從CPU快取上得知該筆資料的內容，而又因資料未載入至CPU暫存器上，需要該資料的指令仍無法得知資料內容，在這裏，基於[分级保护域](../Page/分级保护域.md "wikilink")機制，CPU將資料從CPU快取載入至CPU的[暫存器前是需要經過資料權限檢查和記憶體位址合法性檢查](https://zh.wikipedia.org/wiki/暫存器 "wikilink")，只有這些資料的存取權限被確認等於或低於該行程的權限、記憶體位址空間的存取權限符合該行程的權限時，方能被相應行程的指令存取，否則將資料丟棄並對該指令進行異常處理。但是，而從記憶體載入資料到CPU快取時，CPU是既沒有對這些資料進行權限檢查也沒有進行記憶體位址的合法性檢查的，而沒有被命中的CPU快取的資料也不會馬上被清空。如果CPU快取的資料內容無法被得知，那麼這種機制的處理邏輯並不會有問題，然而如果有方法可以從其它途徑「偷看」CPU快取的資料內容的話，那麼這種處理邏輯便存在缺陷。

要利用熔毀缺陷，在[指令处理期间](https://zh.wikipedia.org/wiki/指令 "wikilink")，用異常的指令使得CPU進入對異常指令的異常處理當中，同時令CPU的推測執行去先執行一些非法指令，内存访问和權限检查或記憶體位址合法性檢查兩種操作在這裏發生竞争冒险，因为受影响的处理器中的[指令流水线意味着在推测执行期间](https://zh.wikipedia.org/wiki/指令流水线 "wikilink")，来自未经授权地址的数据几乎总是被临时加载到CPU的缓存中，即使原始读取指令由于特权检查而最终失败并且从不产生可读结果，這個時候再利用[旁道攻击](../Page/旁路攻击.md "wikilink")，利用存取CPU快取及存取記憶體的時間差，重建目標資料。這樣未经授权的进程就可从映射到当前进程的[内存空间的任何地址读取数据](https://zh.wikipedia.org/wiki/内存 "wikilink")。\[22\]

由于许多操作系统将物理内存、内核进程和其他正在运行的[用户空间进程映射到每个进程的地址空间](https://zh.wikipedia.org/wiki/用户空间 "wikilink")，并依靠特权检查来防止未经授权的访问，因此，熔毁缺陷有效地允许运行在用户空间的恶意进程在不需要权限提升的情况下，读取任何物理内核或其他进程的映射的内存，不管它是否应该能够这样做。若要防范这个缺陷所造成的危害，需要避免使用内存映射方式或使用内存分页隔离（均是基于软件的解决方案，后者是将用户空间的内存地址与内核空间的内存地址相隔离，但这将增加内核态与用户态之间的[上下文交换开销](https://zh.wikipedia.org/wiki/上下文交换 "wikilink")），或避免潜在的竞争条件（修改CPU的[微代码和](https://zh.wikipedia.org/wiki/微程序 "wikilink")/或执行路径）。

惡意程式利用熔毀缺陷進行攻擊活動時也無法被偵測感知，是該資安漏洞的一大危險之處。\[23\]\[24\]

## 受影響硬體

最初發現熔毀缺陷主要在英特爾的微處理器產品上出現，\[25\]但後來發現一些[ARM架構的處理器也有該缺陷並被](https://zh.wikipedia.org/wiki/ARM架構 "wikilink")[ARM確認](../Page/安謀控股.md "wikilink")\[26\]，隨後IBM的[POWER架構的處理器也被發現有此缺陷也得到了IBM的確認](../Page/IBM_POWER.md "wikilink")。\[27\]同爲[x86架構的AMD處理器則沒有被發現有熔毀缺陷](https://zh.wikipedia.org/wiki/x86架構 "wikilink")。\[28\]\[29\]\[30\]\[31\]而英特爾在處理器缺陷被發現公佈數天後，才發表聲明確認，除了使用依序執行的產品以外全系列的英特爾微處理器都有熔毀缺陷，並且在聲明中指所有[非依序執行的x](../Page/乱序执行.md "wikilink")86微處理器都有該缺陷以暗示競爭對手也受熔毀缺陷影響，\[32\]不過另一家主要的x86微處理器供應商[AMD則表示其處理器產品沒有熔毀缺陷](https://zh.wikipedia.org/wiki/AMD "wikilink")，並指出「我們之所以認爲AMD的處理器不受缺陷影響，是因爲我們的[分頁](../Page/分頁.md "wikilink")架構有特權級保護」。\[33\]

同時期的另一個硬體缺陷——[幽靈](https://zh.wikipedia.org/wiki/幽灵_\(安全漏洞\) "wikilink")，受影響的處理器產品遍及當今所有採用[分支預測技術的處理器](https://zh.wikipedia.org/wiki/分支預測 "wikilink")（包括英特爾、AMD、ARM、IBM POWER等等），雖然相比熔燬缺陷更難利用（視不同CPU的微架構有所不同）\[34\]\[35\]\[36\]\[37\]

更爲具體的，有缺陷的CPU型號數量非常多，Google的[Project Zero報告指出](../Page/Project_Zero_\(Google\).md "wikilink")，除了[安騰以及](https://zh.wikipedia.org/wiki/Itanium "wikilink")2013年前的[Atom系列](https://zh.wikipedia.org/wiki/Intel_Atom "wikilink")，英特爾自1995年發表基於[P6微架構](../Page/P6微架構.md "wikilink")的[Pentium Pro開始所有具備非依序執行的CPU產品都有熔燬缺陷](https://zh.wikipedia.org/wiki/Pentium_Pro "wikilink")，\[38\]P6微架構是英特爾首款具備[预测执行的x](https://zh.wikipedia.org/wiki/预测执行 "wikilink")86（[IA-32](https://zh.wikipedia.org/wiki/IA-32 "wikilink")）微架構，首發產品便是Pentium Pro，而後續的英特爾x86微架構除Netburst(Pentuim 4)外都是以P6爲藍本。\[39\]

而ARM表示它們的主要處理器IP核不受影響，具體受影響的IP核型號已經公佈。[ARM Cortex-A75除了有熔毀缺陷以外還受幽靈漏洞的影響](https://zh.wikipedia.org/wiki/ARM_Cortex-A75 "wikilink")，而其它型號則沒有熔毀缺陷。帶預測執行技術的[Cortex-R7](https://zh.wikipedia.org/wiki/ARM_Cortex-R7 "wikilink")、[Cortex-R8](https://zh.wikipedia.org/wiki/ARM_Cortex-R8 "wikilink")、[Cortex-A8](https://zh.wikipedia.org/wiki/Cortex-A8 "wikilink")、[Cortex-A9](https://zh.wikipedia.org/wiki/Cortex-A9 "wikilink")、[Cortex-A15](https://zh.wikipedia.org/wiki/Cortex-A15 "wikilink")、[Cortex-A17](https://zh.wikipedia.org/wiki/Cortex-A17 "wikilink")、[Cortex-A57](https://zh.wikipedia.org/wiki/Cortex-A57 "wikilink")、[Cortex-A72及](https://zh.wikipedia.org/wiki/Cortex-A72 "wikilink")[Cortex-A73](https://zh.wikipedia.org/wiki/Cortex-A73 "wikilink") IP核只受幽靈的影響。\[40\]ARM是在英特爾之後第二個被發現有熔毀缺陷的產品的，但與英特爾的不同，ARM唯一有熔燬缺陷的IP核產品Cortex-A75尚未有實作商用。\[41\]另外，不使用預測執行技術的ARM架構處理器，也是當前使用數量最多的ARM產品，不受任何影響，也沒有熔燬缺陷，這部分包括了大量使用在Android行動裝置上的[Cortex-A53](https://zh.wikipedia.org/wiki/Cortex-A53 "wikilink") IP核，以及即將有商用實作案的[Cortex-A55](https://zh.wikipedia.org/wiki/Cortex-A55 "wikilink")。僅使用Cortex-A53、Cortex-A55的處理器產品包括[高通](../Page/高通.md "wikilink")的[驍龍](../Page/高通驍龍.md "wikilink")630、626/625、400系列等、[聯發科的MT](../Page/聯發科技.md "wikilink")6795等、[樹莓派單板電腦使用的](../Page/树莓派.md "wikilink")[博通SoC等等](../Page/博通_\(公司\).md "wikilink")。\[42\]\[43\]

IBM的POWER架構是第三個被發現有熔燬缺陷、受幽靈的處理器微架構，[紅帽公司](../Page/紅帽公司.md "wikilink")在2018年1月3日公佈了受這些缺陷影響的處理器型號，涵蓋[Z架構](https://zh.wikipedia.org/wiki/IBM_System_Z "wikilink")、POWER架構（包括最新的[POWER8及](https://zh.wikipedia.org/wiki/POWER8 "wikilink")[POWER9](https://zh.wikipedia.org/wiki/POWER9 "wikilink")）的產品，並發表了適用於這些指令集架構編譯版本的[RHEL之修復程式](https://zh.wikipedia.org/wiki/RHEL "wikilink")；IBM也立即公佈了受影響型號清單並發佈了相關的韌體修復程式和AIX、z/OS修復程式。\[44\]

[甲骨文公司](../Page/甲骨文公司.md "wikilink")表示[SPARC](../Page/SPARC.md "wikilink") V9的系統（T5、M5、M6、S7、M7、M8、M10、M12處理器）沒有熔燬缺陷，但並未說明更老的、不再進行技術支援的處理器產品是否受這兩大硬體缺陷的衝擊。\[45\]

## 漏洞修复

2018年初，微软发布了新的[Windows系统的安全补丁以修复漏洞](https://zh.wikipedia.org/wiki/Windows "wikilink")。英特尔公司多次表示修复漏洞并不会过多影响芯片性能，但微软的测试表明在安装了漏洞补丁的[Windows 7与](https://zh.wikipedia.org/wiki/Windows_7 "wikilink")[Windows 8环境下](https://zh.wikipedia.org/wiki/Windows_8 "wikilink")，2015年及以前生产的英特尔芯片会有明显可感的性能下降，有消息说下降幅度甚至可以达到30%，较旧的[Haswell架构与之前的芯片性能下降尤为明显](https://zh.wikipedia.org/wiki/Haswell "wikilink")。但在使用[Skylake](https://zh.wikipedia.org/wiki/Skylake "wikilink")、[Kaby Lake等较新架构的英特尔芯片的](https://zh.wikipedia.org/wiki/Kaby_Lake "wikilink")[Windows 10系统上](../Page/Windows_10.md "wikilink")，性能下降则并不明显。\[46\]

## 参考文献

## 外部链接

  - [Meltdown和Spectre漏洞的官方网站](https://meltdownattack.com/)
  - [Meltdown论文](https://meltdownattack.com/meltdown.pdf)
  - [Google Project Zero write-up](https://googleprojectzero.blogspot.com/2018/01/reading-privileged-memory-with-side.html)
  - [网络安全实践指南—CPU熔断和幽灵漏洞防范指引](http://www.tc260.org.cn/upload/2018-01-16/1516081883218060656.pdf)

## 参见

  - [幽灵 (安全漏洞)](https://zh.wikipedia.org/wiki/幽灵_\(安全漏洞\) "wikilink")（Spectre）

  - [内核页表隔离](../Page/内核页表隔离.md "wikilink")

  -
  - [奔腾浮点除错误](../Page/奔腾浮点除错误.md "wikilink")

{{-}}

[Category:電腦安全](https://zh.wikipedia.org/wiki/Category:電腦安全 "wikilink") [Category:硬件漏洞](https://zh.wikipedia.org/wiki/Category:硬件漏洞 "wikilink") [Category:旁路攻击](https://zh.wikipedia.org/wiki/Category:旁路攻击 "wikilink") [Category:Intel_x86處理器](https://zh.wikipedia.org/wiki/Category:Intel_x86處理器 "wikilink") [Category:X86架構](https://zh.wikipedia.org/wiki/Category:X86架構 "wikilink") [Category:X86内存管理](https://zh.wikipedia.org/wiki/Category:X86内存管理 "wikilink") [Category:程式錯誤](https://zh.wikipedia.org/wiki/Category:程式錯誤 "wikilink")

1.  [英特尔芯片存漏洞？苹果微软纷纷中招紧急打补丁-寰球立方体-新华网](http://www.xinhuanet.com/world/2018-01/05/c_129784053.htm)

2.  [CVE-2017-5754](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2017-5754)，于[Mitre Corporation](https://zh.wikipedia.org/wiki/Mitre_Corporation "wikilink")

3.  [CVE-2017-5754](https://nvd.nist.gov/vuln/detail/CVE-2017-5754)，于[美国国家漏洞数据库](https://zh.wikipedia.org/wiki/美国国家漏洞数据库 "wikilink")

4.

5.

6.

7.

8.

9.

10.

11.

12.

13.

14.

15.

16.

17.

18.

19.

20.

21.

22.

23.

24. <https://www.cybereason.com/blog/what-are-the-spectre-and-meltdown-vulnerabilities>

25.

26.
27.

28.

29.

30.

31.

32.

33.

34.

35.

36.

37.

38.

39.

40.

41.

42.

43.

44.

45.

46. [安全漏洞作祟、微軟：更新會拖慢電腦](https://www.moneydj.com/KMDJ/News/NewsViewer.aspx?a=fb5e7bc2-42be-4465-9619-de0b8964b582)
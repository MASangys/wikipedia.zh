[加密系统的安全性取决于秘密保护的数据](../Page/密码学.md "wikilink")，这些数据应该对已授权者可知，但是对其他人不可知且不可预测。实现不可预测特征的方法就是部署[随机化](https://zh.wikipedia.org/wiki/随机化 "wikilink")。现代[加密协议通常需要频繁生成随机的数量](../Page/安全协议.md "wikilink")，在这个过程中破坏或利用弱点的攻击被称为随机数生成器攻击。

对于安全需求来说，高质量的[随机数发生](https://zh.wikipedia.org/wiki/随机数生成器 "wikilink")（RNG）的过程几乎总是有需要的。生成过程缺乏质量通常会导致受攻击时的脆弱性，因此导致密码系统缺乏安全性，甚至完全不安全。RNG的过程对于攻击者而言是特别有吸引力的，因为它通常位于一个孤立的易于定位的硬件或软件。
如果攻击者可以用一种他可以预测的伪随机数替换RNG过程，安全性就会受到完全损害，但是上游的测试对此通常是无法侦测到的。不仅如此，这种攻击只需要接入一次受攻击的系统，不需要向攻击者返回任何数据，换句话说，就是一个[计算机病毒](../Page/计算机病毒.md "wikilink")
，偷取了[密钥然后用电子邮件向一些接受点发送](../Page/密钥.md "wikilink")。

## 人工生成的随机数

人工生成的随机数通常极差。魔术师，职业赌徒和骗子，他们都依赖于预测人的行为。
在[第二次世界大战中](../Page/第二次世界大战.md "wikilink")，德国代码文员被指示随机挑选三个字母作为[恩尼格玛密码机中每条消息的转子初始设置](../Page/恩尼格玛密码机.md "wikilink")。但是，有些人选取了可预测的值，比如他们的女友的姓名的首字母，这大大帮助了盟军破译德国的加密系统。另一个例子就是计算用户选择密码的方式通常可以预测（参见[密码破解](https://zh.wikipedia.org/wiki/密码破解 "wikilink")）。

尽管如此，Ran Halprin 与 [Moni
Naor](https://zh.wikipedia.org/wiki/Moni_Naor "wikilink")
研究了在[混合策略游戏中的一些特定情况下](../Page/策略_\(博弈論\).md "wikilink")，使用的人玩游戏时的[熵来产生随机性](../Page/熵.md "wikilink")。\[1\]

## 攻击

### 软件随机数生成器

仅作为加密系统的其它组件而言，软件随机数发生器在设计上应该能抵抗一定的攻击。攻击类型可能包括\[2\]：

  - 直接密码分析攻击
    若攻击者可以获得随机数生成序列的一部分，并且可以据此将发生器的输出从真正的随机流中区分出来时，此类攻击可行。
  - 以输入为基础的攻击
    修改发生器的输入来进行攻击，例如通过将现存的熵“清洗”出现有的系统，并把系统设置为已知的状态。
  - 状态妥协扩展攻击
    在内部保密状态的发生器在某个时间是已知的，据此可以预测未来发生器的输出或恢复之前的输出。
    这可能发生在发生器刚刚启动并且发生器仅拥有少量或没有拥有任何熵的时候（特别是计算机刚刚启动并且正在执行一个非常标准的操作序列的时候），因此在这个状态下，攻击者可能能够获得初步的猜测值。

### 硬件随机数生成器

许多针对[硬件随机数生成器的攻击都是有可能的](https://zh.wikipedia.org/wiki/硬件随机数生成器 "wikilink")，包括尝试捕获计算机的射频发射（例如从电机噪音中推断硬盘中断时间），或者尝试将受控的信号反馈到假定的随机源当中（比如关闭熔岩灯中的灯光或是将已知的强信号反馈到声卡）。

### 随机数生成器颠覆

颠覆随机数可以在[密码学安全伪随机数生成器中使用随机数种子值来生成](../Page/密码学安全伪随机数生成器.md "wikilink")，[种子值虽然隐藏在软件中](https://zh.wikipedia.org/wiki/种子值 "wikilink")，但是对攻击者已知。相对较短，比如24到40比特，种子可以是真正随机的，可以防止重复，但是并不足以防止攻击者恢复“随机”生成的密钥。

随机数在使用前会通过数层特定的软件和硬件。数据可能在外围设备中生成，通过电缆传输，由操作系统组件收集并由系统调用进行检索。这一过程中的任何一点都可以替换颠覆的数据，并且几乎无法检测。

仅仅需要数平方毫米就可以使用[集成电路建造一个用于生成颠覆随机数的硬件电路](../Page/集成电路.md "wikilink")。通过将这种芯片放置在上游任何随机性来源数字化的地方，就可以破坏最先进的硬件随机数生成器，例如在输出驱动芯片中甚至在把计算机与生成器连接起来的电缆中。破坏芯片可以带有一个时钟来来把操作启动时间限制到单位初次启动之后，并且还能通过接受测试，也可以带有用于开关控制的无线电接收器。破坏芯片的安装可以是国家情报服务机构对制造商的要求，或者是之后任何有物理访问权的人。用于替换内置硬件随机数生成器的[CPU芯片的可以是任意的兼容芯片](https://zh.wikipedia.org/wiki/CPU "wikilink")，其固件中可以包含已颠覆的随机数生成器。

## 防御

  - 将硬件生成的随机数与高质量流加密输出（比如[逻辑异或](../Page/逻辑异或.md "wikilink"))混合，并尽可能地接近使用点。流加密密钥与随机数种子应当可以用可审计的方式进行修改并从可信来源中派生，例如掷骰子。[Fortuna随机数生成器就是一个使用这些机制的范例算法](https://zh.wikipedia.org/wiki/Fortuna "wikilink")。
  - 使用真正随机的来源生成密码。有些系统会代为用户选择随机密码而不让用户自行提交。
  - 使用加密系统来记录随机数生成过程，并提供审计生成过程的方法。
  - 用现有的硬件构建安全系统，最好以未告知预期用途的方式购买硬件，例如大型零售机构。从这个角度来说，[声卡与](../Page/声卡.md "wikilink")[网络摄像头对比](https://zh.wikipedia.org/wiki/网络摄像头 "wikilink")[硬件随机数生成器是更好的随机化来源](https://zh.wikipedia.org/wiki/硬件随机数生成器 "wikilink")。
  - 在购买后保持对硬件的完全物理控制。

设计一个安全随机数生成器至少要求与设计密码系统的其它部分一样高的水平。

## 突出例子

### 可预测的网景随机数种子

在早期版本的[网景](https://zh.wikipedia.org/wiki/网景 "wikilink")[传输层安全性协议](../Page/傳輸層安全性協定.md "wikilink")（SSL）中的加密协议中使用了伪随机数，来源是伪随机数生成器根据三个变量派生的：一天中的时间、进程ID与父进程ID。这些伪随机数相对而言通常是可预测的，因此[熵值很低并且也少于随机数](../Page/熵.md "wikilink")，亦因此发现这一版本的SSL并不安全。[Phillip
Hallam-Baker于](https://zh.wikipedia.org/wiki/Phillip_Hallam-Baker于 "wikilink")1994年向网景公司报告了问题所在，随后也向CERN网络团队的一位研究员报告。但是问题在发布前并未修复。1995年，Ian
Goldberg与David
Wagner发现了这一问题\[3\]，二人当时因为网景公司拒绝透露其随机数字生成器（[静默安全性](https://zh.wikipedia.org/wiki/静默安全性 "wikilink")）的细节，而不得不对[目标代码进行](../Page/目标代码.md "wikilink")[逆向工程](https://zh.wikipedia.org/wiki/反向工程 "wikilink")。随机数生成器在后来的版本（第二版及更高）中通过更强的随机数种子（即从攻击者的角度来看，更随机和更高的熵）得到修复。

### Microsoft Windows 2000/XP 中的随机数生成器

微软使用未发布的算法来为其[Windows操作系统生成随机数值](https://zh.wikipedia.org/wiki/Windows操作系统 "wikilink")，并通过[CryptGenRandom实用工具提供给用户](https://zh.wikipedia.org/wiki/CryptGenRandom "wikilink")。2007年11月，来自[耶路撒冷希伯来大学与](https://zh.wikipedia.org/wiki/耶路撒冷希伯来大学 "wikilink")[海法大学的Leo](../Page/海法大学.md "wikilink")
Dorrendorf et al. 发布了一篇名为*Cryptanalysis of the Random Number Generator
of the Windows Operating System （Windows操作系统中的随机数生成器的密码学分析）*的论文。\[4\]
文中指出了当时微软的生成方法中的严重缺陷，结论基于对Windows
2000中代码的[反汇编](../Page/反汇编器.md "wikilink")，但是根据微软的说法，这些代码也存在于Windows
XP。\[5\] 微软已经表示，文中描述的问题已经在Windows的后续版本中得到解决，后者使用了不同的随机数生成实现。

### 椭圆曲线DRBG中可能的后门

美国[国家标准技术研究所](../Page/國家標準技術研究所.md "wikilink")（NIST）发布了“确定性随机位发生器”，并且推荐于NIST的特刊800至890期中。\[6\]其中叫[Dual_EC_DRBG的生成器受到了](https://zh.wikipedia.org/wiki/Dual_EC_DRBG "wikilink")[国家安全局](../Page/美国国家安全局.md "wikilink")（NSA）的青睐。\[7\]
Dual_EC_DRBG使用[椭圆曲线加密并包含一组推荐使用的常量](../Page/椭圆曲线密码学.md "wikilink")。2007年八月，来自[微软的Dan](../Page/微软.md "wikilink")
Shumow与Niels
Ferguson显示这些常量可以通过在算法中创建一个[窃密学](https://zh.wikipedia.org/wiki/窃密学 "wikilink")[后门的方式来构建](https://zh.wikipedia.org/wiki/后门 "wikilink")。\[8\]
2013年九月，*The New York
Times（纽约时报）*发文称“NSA向NIST于2006年接纳的一向标准中植入了后门...名为Dual
EC
DRBG标准”，\[9\]从而揭示了NSA对美国人民进行了恶意软件攻击。2013年12月，据路透社报道，[爱德华·斯诺登](../Page/爱德华·斯诺登.md "wikilink")（Edward
Snowden）发布的文件显示，NSA已经向[RSA安全局支付了](https://zh.wikipedia.org/wiki/RSA安全局 "wikilink")1000万美元，将Dual_EC_DRBG作为后者的默认加密软件，也因此出现更多关于该算法包含NSA后门的担忧。\[10\]出于这些担忧，2014年，NIST从其关于随机数发生器的指导草案中撤销了，推荐“现有的Dual
EC DRBG用户尽快切换到其余三个算法。”\[11\]

### MIFARE Crypto-1

Crypto-1是由[NXP开发的用于](../Page/恩智浦半导体.md "wikilink")[MIFARE芯片的加密系统](https://zh.wikipedia.org/wiki/MIFARE "wikilink")。作为专有系统，其算法最初并未公布。根据对芯片的逆向工程，来自弗吉尼亚大学与[Chaos
Computer
Club的研究人员发现了针对Crypto](https://zh.wikipedia.org/wiki/Chaos_Computer_Club "wikilink")-1中随机数发生器的初始化不良漏洞。\[12\]

### Debian OpenSSL

2008年五月，安全研究员Luciano Bello透漏了一项发现，关于2006年在随[Debian
GNU/Linux和其他基于Debian的发行版](../Page/Debian.md "wikilink")，例如[Ubuntu](../Page/Ubuntu.md "wikilink")，中分发的[OpenSSL软件包中随机数生成器的变化](../Page/OpenSSL.md "wikilink")。这些变化大大降低了生成值的熵值，使得各种安全密钥易受攻击。\[13\]\[14\]这个安全漏洞是由于Debian开发者为解决冗余代码的编译器警告，随即对OpenSSL代码做出了这些修改，\[15\]从而导致了密钥在世界范围内的大量重构，尽管所有人都注意到了这个问题，但可以推测出许多旧密钥仍在使用中。受影响的密钥类型包含[SSH密钥](../Page/Secure_Shell.md "wikilink")、[OpenVPN密钥](../Page/OpenVPN.md "wikilink")、[DNSSEC密钥](../Page/域名系统安全扩展.md "wikilink")、[SSL/TLS连接中使用的](../Page/傳輸層安全性協定.md "wikilink")[X.509证书密钥材料与](../Page/X.509.md "wikilink")[会话密钥](https://zh.wikipedia.org/wiki/Session_key "wikilink")。使用GnuPG或GNUTLS生成的密钥由于使用了不同的方法来生成随机数而未受到影响。由非Debian系的Linux发行版生成的密钥也未受到影响。接到报告之后，漏洞及时得到修补，但是任何仍然使用由旧代码生成的密钥的服务仍然是脆弱。许多软件包现在都包含针对弱密钥黑名单的检查，以试图预防使用剩余的弱密钥，但是研究人员仍旧陆续发现了薄弱的密钥实现。\[16\]

### PlayStation 3

2010年12月，一个自称*fail0verflow*
的团体宣布了恢复[椭圆曲线数字签名算法](https://zh.wikipedia.org/wiki/椭圆曲线数字签名算法 "wikilink")（ECDSA）私钥的方法。[索尼公司使用这种私钥来为](https://zh.wikipedia.org/wiki/索尼公司 "wikilink")[PlayStation
3来签名游戏包](../Page/PlayStation_3.md "wikilink")。攻击的可能性来源于由于索尼未能为每个签名产生一个新的随机数。\[17\]

### RSA公钥分解

2012年，Lenstra、Hughes、Augier、Bos、Kleinjung与Wachter发布了一篇关于从互联网收集数百万个[RSA公钥的分析](../Page/RSA加密演算法.md "wikilink")。他们仅使用了[欧几里得算法就分解了](https://zh.wikipedia.org/wiki/欧几里得算法 "wikilink")0.2%的密钥，\[18\]\[19\]利用的是基于整数分解的密码系统特有的弱点。若
*n* = *pq* 是一个公钥，*n*′ = *p*′*q*′ 是另一个，那么如果偶然间 *p* =
*p*′，那么简单计算gcd(*n*,*n*′) = *p* 因数都是 *n* 和
*n*′，完全破坏了两个密钥。一个进行过类似实验的组织的一员Nadia
Heninger说，劣质密钥几乎完全出现于[嵌入式系统中](../Page/嵌入式系统.md "wikilink")，由两组结果发现的共享素数问题是由于伪随机数发生器最初做种不良，然后在第一个和第二个素数的产生之间发生了重新做种。

### Java实时碰撞

2013年八月，据透露[Java类](../Page/Java.md "wikilink")[SecureRandom](http://docs.oracle.com/javase/7/docs/api/java/security/SecureRandom.html)中的错误可以在用于[Android设备上](../Page/Android.md "wikilink")[比特币软件中的](../Page/比特币.md "wikilink")*k*
nonce数值上生成冲突。当错误触发时，私钥可以恢复，因而导致包含钱包中的[比特币失窃](../Page/比特币.md "wikilink")。\[20\]

## 另见

  - 伪随机数生成器
  - [密码学安全伪随机数生成器](../Page/密码学安全伪随机数生成器.md "wikilink")
  - 密钥生成
  - [一次性密码本](../Page/一次性密碼本.md "wikilink")
  - [盐](../Page/盐_\(密码学\).md "wikilink")
  - [Nonce](https://zh.wikipedia.org/wiki/Nonce "wikilink")

## 参考资料

## 延伸阅读

  -
  -
[Category:含有冗余参数的引用的页面](https://zh.wikipedia.org/wiki/Category:含有冗余参数的引用的页面 "wikilink")
[Category:含有冗余参数的引用的页面](https://zh.wikipedia.org/wiki/Category:含有冗余参数的引用的页面 "wikilink")
[Category:含有冗余参数的引用的页面](https://zh.wikipedia.org/wiki/Category:含有冗余参数的引用的页面 "wikilink")
[Category:含有冗余参数的引用的页面](https://zh.wikipedia.org/wiki/Category:含有冗余参数的引用的页面 "wikilink")
[Category:密码分析](https://zh.wikipedia.org/wiki/Category:密码分析 "wikilink")

1.
2.
3.
4.
5.
6.
7.
8.  `|author=`和`|last=`只需其一
    ([帮助](https://zh.wikipedia.org/wiki/Help:引文格式1错误#redundant_parameters "wikilink"))
9.
10. `|author=`和`|last=`只需其一
    ([帮助](https://zh.wikipedia.org/wiki/Help:引文格式1错误#redundant_parameters "wikilink"))
11.
12.
13.
14.
15. `|author=`和`|last=`只需其一
    ([帮助](https://zh.wikipedia.org/wiki/Help:引文格式1错误#redundant_parameters "wikilink"))
16. <http://theregister.co.uk/2015/06/03/compromised_ssh_keys_used_to_access_uk_govt_spotify_github_repos/>
17.
18. `|work=`和`|newspaper=`只需其一
    ([帮助](https://zh.wikipedia.org/wiki/Help:引文格式1错误#redundant_parameters "wikilink"))
19.
20.
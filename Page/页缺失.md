**-{zh-cn:页缺失;zh-tw:分頁錯誤;}-**（，又名**硬错误**、**硬中断**、**-{zh-cn:分页错误;zh-tw:頁缺失;}-**、**寻页缺失**、**缺页中断**、**页故障**等）指的是当软件试图访问已映射在[虚拟](../Page/虚拟地址.md "wikilink")[地址空间中](../Page/地址空间.md "wikilink")，但是目前并未被加载在[物理内存中的一个](../Page/物理内存.md "wikilink")[分页时](../Page/分页.md "wikilink")，由[中央处理器的](../Page/中央处理器.md "wikilink")[内存管理单元所发出的](../Page/内存管理单元.md "wikilink")[中断](../Page/中断.md "wikilink")。

通常情况下，用于处理此中断的程序是[操作系统的一部分](../Page/操作系统.md "wikilink")。如果操作系统判断此次访问是有效的，那么操作系统会尝试将相关的分页从硬盘上的[虚拟内存文件中调入内存](../Page/虚拟内存.md "wikilink")。而如果访问是不被允许的，那么操作系统通常会结束相关的[进程](../Page/进程.md "wikilink")。\[1\]

虽然其名为“页缺失”错误，但实际上这并不一定是一種错误。而且这一机制对于利用[虚拟内存来增加程序可用内存空间的操作系统](../Page/虚拟内存.md "wikilink")（比如[Microsoft
Windows和各种](../Page/Microsoft_Windows.md "wikilink")[类Unix系统](../Page/类Unix系统.md "wikilink")）中都是常见且有必要的。

微软在较新版Windows的[资源监视器中使用](../Page/资源监视器.md "wikilink")“**-{zh-cn:硬错误;zh-tw:硬體錯誤;}-**”（[Windows
Vista及以上](../Page/Windows_Vista.md "wikilink")）、“**-{zh-cn:硬中断;zh-tw:硬體中斷;}-**”（[Windows
8及以上](../Page/Windows_8.md "wikilink")）这一术语来指代“页缺失”。\[2\]

## 分类

### 软性

**软性页缺失**指页缺失发生时，相关的页已经被加载进内存，但是没有向MMU注册的情况。操作系统只需要在MMU中注册相关页对应的物理地址即可。\[3\]

发生这种情况的可能性之一，是一块物理内存被两个或多个程序[共享](../Page/共享内存.md "wikilink")，操作系统已经为其中的一个装载并注册了相应的页，但是没有为另一个程序注册。

可能性之二，是该页已被从CPU的[工作集中移除](../Page/工作集.md "wikilink")，但是尚未被交换到[磁盘上](../Page/磁盘.md "wikilink")。比如[OpenVMS这样的使用次级页缓存的系统](../Page/OpenVMS.md "wikilink")，就有可能会在工作集过大的情况下，将某页从工作集中去除，但是不写入硬盘也不擦除（比如说这一页被读出硬盘后没被修改过），只是放入空闲页表。除非有其他程序需要，导致这一页被分配出去了，不然这一页的内容不会被修改。当原程序再次需要该页内的数据时，如果这一页确实没有被分配出去，那么系统只需要重新为该页在MMU内注册映射即可。\[4\]

### 硬性

与软性页缺失相反，**硬性页缺失**是指相关的页在页缺失发生时未被加载进内存的情况。这时操作系统需要：\[5\]

1.  寻找到一个空闲的页。或者把另外一个使用中的页写到磁盘上（如果其在最后一次写入后发生了变化的话），并注销在MMU内的记录
2.  将数据读入被选定的页
3.  向MMU注册该页

硬性页缺失导致的性能损失是很大的。以一块7200[rpm的主流](../Page/每分鐘轉速.md "wikilink")[机械硬盘为例](../Page/硬盘.md "wikilink")，其平均寻道时间为8.5毫秒，读入内存需要0.05毫秒。相对的，[DDR3内存的访问延迟通常在数十到](../Page/DDR3_SDRAM.md "wikilink")100纳秒之间，性能差距可能会达到8万到22万倍。

另外，有些操作系统会将程序的一部分延迟到需要使用的时候再加载入内存执行，以此来提升性能。这一特性也是通过捕获硬性页缺失达到的。\[6\]

当硬性页缺失过于频繁的发生时，称发生[系統顛簸](../Page/分頁#系統顛簸.md "wikilink")。

### 无效

当程序访问的虚拟地址是不存在于虚拟地址空间内的时候，则发生**无效页缺失**。一般来说这是个软件问题，但是也不排除硬件可能，比如因为内存故障而损坏了一个正确的[指针](../Page/指针_\(信息学\).md "wikilink")。

具体动作与所使用的操作系统有关，比如Windows会使用[异常机制向程序报告](../Page/异常处理.md "wikilink")，而[类Unix系统则会使用](../Page/类Unix系统.md "wikilink")[信号机制](../Page/信号_\(计算机科学\).md "wikilink")。如果程序未处理相关问题，那么操作系统会执行默认处理方式，通常是[转储内存](../Page/核心文件.md "wikilink")、终止相关的程序，然后向用户报告。\[7\]\[8\]

## 参考与延伸阅读

  - John L. Hennessy, David A. Patterson, *Computer Architecture, A
    Quantitative Approach* (ISBN 1-55860-724-2)
  - Tanenbaum, Andrew S. *Operating Systems: Design and Implementation
    (Second Edition)*. New Jersey: Prentice-Hall 1997.
  - *Intel Architecture Software Developer's Manual*–Volume 3: System
    Programming

[Category:计算机错误](https://zh.wikipedia.org/wiki/Category:计算机错误 "wikilink")
[Category:虚拟内存](https://zh.wikipedia.org/wiki/Category:虚拟内存 "wikilink")

1.  Red Hat Enterprise Linux 3: Introduction to System Administration,

2.  参见英文Windows资源监视器帮助

3.
4.  HP OpenVMS Systems Documentation,

5.

6.  Red Hat Enterprise Linux 3: Introduction to System Administration,
    See note.

7.
8.